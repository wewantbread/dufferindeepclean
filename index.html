<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>DufferinDeepClean</title>

  <!-- Favicons / PWA -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="DeepClean" />
  <link rel="manifest" href="/site.webmanifest" />

  <!-- Fonts + CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Great+Vibes&family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />

  <!-- Page-specific tweaks (safe to keep inline) -->
  <style>
    /* keep sections above animated bg from style.css */
    .navbar, .split-screen, .services-page, .about-section, main, section, footer { position:relative; z-index:2; }

    /* Transparent header over infinite bg */
    .navbar{
      background: rgba(0,0,0,0.25) !important;
      backdrop-filter: blur(6px);
      border-bottom: 1px solid rgba(255,255,255,0.07);
    }

    /* Logo: match ‚Äúabout us‚Äù font + left‚Üíright reveal + bigger */
    @keyframes logoUnveil{0%{clip-path:inset(0 100% 0 0);opacity:0}40%{opacity:1}100%{clip-path:inset(0 0 0 0);opacity:1}}
    @keyframes logoSweep{0%{opacity:1;transform:translateX(-105%)}60%{opacity:.75}100%{opacity:0;transform:translateX(120%)}}
    .logo .logo-text{
      font-family: 'Great Vibes', cursive !important;
      font-size: 2.8rem !important;
      letter-spacing: .5px;
      color:#fff !important;
      position:relative;
      display:inline-block;
      clip-path: inset(0 100% 0 0);
      opacity:0; animation: logoUnveil 1.1s ease forwards .25s;
    }
    .logo .logo-text::after{
      content:""; position:absolute; inset:0;
      background: linear-gradient(90deg, rgba(0,212,255,.85), rgba(255,255,255,.95));
      mix-blend-mode: screen; opacity:0; pointer-events:none;
      animation: logoSweep 1.1s ease forwards .25s;
    }

    /* Nav links in same script font */
    .nav-links a{
      font-family:'Great Vibes', cursive !important;
      font-size:1.6rem !important;
      letter-spacing:.02em;
      color:#f6fbff;
    }

    /* Hero image flush to right edge */
    .image-side img{
      transform:none !important;
      object-position: right center !important;
    }

    /* ===== ABOUT (restored) ===== */
    .about-section { padding: 6em 2em 7em; }
    .about-inner{
      max-width:1100px; margin:0 auto; display:flex; align-items:flex-start; justify-content:space-between; gap:3rem;
      background: rgba(0,0,0,0.55); border: 1px solid rgba(0,212,255,0.25); border-radius: 28px; padding: 3em;
      box-shadow: 0 40px 90px rgba(0,0,0,0.45); position:relative;
    }
    .about-intro{ letter-spacing:.35rem; font-size:.85rem; text-transform:uppercase; color:rgba(0,212,255,0.75); margin-bottom:1rem; }
    .about-title{ margin-bottom:1.2rem; position:relative; }
    .about-script{ font-family:'Great Vibes', cursive; font-size:4rem; text-transform:lowercase; color:#f3fbff; letter-spacing:.1rem; position:relative; }
    .about-script::after{
      content:""; position:absolute; left:0; bottom:-6px; height:4px; width:100%;
      background: linear-gradient(90deg, rgba(0,212,255,0) 0%, rgba(0,212,255,0.8) 35%, rgba(0,212,255,1) 55%, rgba(0,212,255,0) 100%);
      border-radius:999px; transform-origin:left center; animation: underlineGrow .7s ease .3s both;
    }
    .about-slogan{ font-size:1.35rem; color:#d2ebff; line-height:1.6; margin-bottom:1.75rem; max-width:28ch; }
    .about-description{ display:grid; gap:1rem; color:#cfe9ff; font-size:1.05rem; line-height:1.7; }
    .about-soap{
      font-size:5rem; color:#00d4ff; position:absolute; left:76%; top:58%;
      transform:translate(-50%,-50%); pointer-events:none; z-index:2;
    }
    .about-soap::before{
      content:""; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
      width:220px; height:220px; border-radius:50%;
      background: radial-gradient(circle, rgba(0,212,255,.38) 0%, rgba(0,212,255,0) 70%);
      filter: blur(20px); z-index:-1;
    }

    /* iOS-only quick fixes keep working via style.css rules */
  </style>
</head>
<body>

  <!-- NAVIGATION -->
  <header class="navbar">
    <div class="logo">
      <span class="soap">üßº</span>
      <a class="logo-text" href="/">DufferinDeepClean</a>
    </div>
    <nav class="nav-links">
      <a href="#home">Home</a>
      <a href="#services">Services</a>
      <a href="#about">About Us</a>
      <a href="book.html#start" class="quote-btn">Book Online</a>
    </nav>
  </header>

  <!-- HERO -->
  <section id="home" class="split-screen">
    <div class="text-side">
      <div id="quote" class="hero-quote" aria-labelledby="quote-title">
        <div class="quote-card">
          <div class="quote-card-header">
            <h2 id="quote-title">custom cleaning quote</h2>
            <p>Answer a few quick questions to unlock a tailored estimate for your space.</p>
          </div>

          <form id="instant-quote" class="quote-form" data-quote-mode="redirect" data-redirect="book.html" data-redirect-anchor="start" novalidate>
            <div class="quote-grid">
              <label class="field" for="quote-first-name">
                <span class="field-label">First Name</span>
                <input id="quote-first-name" name="first-name" type="text" placeholder="e.g. Jordan" autocomplete="given-name" data-required>
              </label>

              <label class="field" for="quote-email">
                <span class="field-label">Email</span>
                <input id="quote-email" name="email" type="email" placeholder="you@example.com" autocomplete="email" data-required>
              </label>

              <label class="field field-inline" for="quote-service">
                <span class="field-label">Type of Service</span>
                <div class="select-wrap">
                  <select id="quote-service" name="service" data-required>
                    <option value="" disabled selected>Select a service</option>
                    <option value="home">Home General Cleaning</option>
                    <option value="commercial">Factory / Commercial / Industrial Cleaning</option>
                    <option value="office">Office Workspace Cleaning</option>
                  </select>
                </div>
              </label>

              <label class="field field-inline" for="quote-sqft">
                <span class="field-label">Square Footage</span>
                <div class="select-wrap">
                  <select id="quote-sqft" name="square-footage" data-required>
                    <option value="" disabled selected>Select an approximate size</option>
                    <option value="1000-1500">1,000 ‚Äì 1,500 sq ft</option>
                    <option value="1500-2000">1,500 ‚Äì 2,000 sq ft</option>
                    <option value="2000-2500">2,000 ‚Äì 2,500 sq ft</option>
                    <option value="2500-3000">2,500 ‚Äì 3,000 sq ft</option>
                    <option value="3000-3500">3,000 ‚Äì 3,500 sq ft</option>
                    <option value="3500-4000">3,500 ‚Äì 4,000 sq ft</option>
                  </select>
                </div>
              </label>
            </div>

            <div id="service-details" class="service-details" aria-live="polite">
              <div class="service-detail-group detail-inline" data-service-detail="home" aria-hidden="true">
                <label class="detail-inline-field" for="home-rooms">
                  <span class="detail-card-label">Number of bedrooms</span>
                  <div class="number-wrap">
                    <input id="home-rooms" name="home-rooms" type="number" min="1" max="12" step="1" inputmode="numeric" placeholder="0" data-required data-service-required="home" data-label-prefix="bedroom" data-label-plural="bedrooms" data-detail-key="homeRooms">
                  </div>
                </label>
                <label class="detail-inline-field" for="home-bathrooms">
                  <span class="detail-card-label">Number of bathrooms</span>
                  <div class="number-wrap">
                    <input id="home-bathrooms" name="home-bathrooms" type="number" min="1" max="10" step="1" inputmode="numeric" placeholder="0" data-required data-service-required="home" data-label-prefix="bathroom" data-label-plural="bathrooms" data-detail-key="homeBathrooms">
                  </div>
                </label>
                <div class="detail-inline-field detail-inline-pets" data-detail-pets>
                  <span class="detail-card-label">Pets on site?</span>
                  <input type="hidden" name="home-pets" data-required data-service-required="home">
                  <div class="mini-pill-group tight" role="radiogroup" aria-label="Are there pets?">
                    <button type="button" class="mini-pill" data-target-input="home-pets" data-value="no" data-label="No pets">No</button>
                    <button type="button" class="mini-pill" data-target-input="home-pets" data-value="yes" data-label="Yes, pets">Yes</button>
                  </div>
                </div>
                <div class="detail-inline-field detail-inline-basement" data-detail-basement>
                  <span class="detail-card-label">Basement?</span>
                  <input type="hidden" name="home-basement" data-required data-service-required="home">
                  <div class="mini-pill-group tight" role="radiogroup" aria-label="Is a basement included?">
                    <button type="button" class="mini-pill" data-target-input="home-basement" data-value="no" data-label="No basement">No</button>
                    <button type="button" class="mini-pill" data-target-input="home-basement" data-value="yes" data-label="Basement included">Yes</button>
                  </div>
                </div>
                <div class="detail-basement-extra" data-basement-extra hidden aria-hidden="true">
                  <label class="detail-inline-field" for="home-basement-rooms">
                    <span class="detail-card-label">Basement rooms</span>
                    <div class="number-wrap">
                      <input id="home-basement-rooms" name="home-basement-rooms" type="number" min="1" max="8" step="1" inputmode="numeric" placeholder="0" data-required data-service-required="home" data-dependent-on="home-basement" data-dependent-value="yes" data-label-prefix="basement room" data-label-plural="basement rooms" data-detail-key="homeBasementRooms">
                    </div>
                  </label>
                  <label class="detail-inline-field" for="home-basement-bathrooms">
                    <span class="detail-card-label">Basement bathrooms</span>
                    <div class="number-wrap">
                      <input id="home-basement-bathrooms" name="home-basement-bathrooms" type="number" min="1" max="4" step="1" inputmode="numeric" placeholder="0" data-required data-service-required="home" data-dependent-on="home-basement" data-dependent-value="yes" data-label-prefix="basement bathroom" data-label-plural="basement bathrooms" data-detail-key="homeBasementBathrooms">
                    </div>
                  </label>
                </div>
              </div>

              <div class="service-detail-group" data-service-detail="office" aria-hidden="true">
                <p class="service-detail-title">Office Workspace Details</p>
                <div class="detail-card-grid">
                  <div class="detail-card">
                    <span class="detail-card-label">Number of Offices</span>
                    <input type="hidden" name="office-offices" data-required data-service-required="office">
                    <div class="mini-pill-group tight" role="radiogroup" aria-label="Number of offices">
                      <button type="button" class="mini-pill" data-target-input="office-offices" data-value="1-5" data-label="1 ‚Äì 5 offices">1‚Äì5</button>
                      <button type="button" class="mini-pill" data-target-input="office-offices" data-value="6-10" data-label="6 ‚Äì 10 offices">6‚Äì10</button>
                      <button type="button" class="mini-pill" data-target-input="office-offices" data-value="11-20" data-label="11 ‚Äì 20 offices">11‚Äì20</button>
                      <button type="button" class="mini-pill" data-target-input="office-offices" data-value="21+" data-label="21+ offices">21+</button>
                    </div>
                  </div>
                  <div class="detail-card">
                    <span class="detail-card-label">Number of Bathrooms</span>
                    <input type="hidden" name="office-bathrooms" data-required data-service-required="office">
                    <div class="mini-pill-group tight" role="radiogroup" aria-label="Number of bathrooms">
                      <button type="button" class="mini-pill" data-target-input="office-bathrooms" data-value="1-2" data-label="1 ‚Äì 2 bathrooms">1‚Äì2</button>
                      <button type="button" class="mini-pill" data-target-input="office-bathrooms" data-value="3-4" data-label="3 ‚Äì 4 bathrooms">3‚Äì4</button>
                      <button type="button" class="mini-pill" data-target-input="office-bathrooms" data-value="5+" data-label="5+ bathrooms">5+</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="quote-summary" aria-live="polite">
              <div class="quote-summary-line">
                <span>Base Package</span>
                <strong data-quote-base>‚Äî</strong>
              </div>
              <div class="quote-summary-line" data-quote-detail-row hidden>
                <span>Service Details</span>
                <strong data-quote-detail>‚Äî</strong>
              </div>
              <div class="quote-summary-line total">
                <span>Estimated Visit Total</span>
                <strong data-quote-total>‚Äî</strong>
              </div>
            </div>

            <div class="quote-actions">
              <button type="button" id="quote-see-price" class="quote-see-price" disabled>See My Price</button>
            </div>
          </form>
        </div>
      </div>

      <a href="#services" class="services-btn-home">Our Services</a>
    </div>

    <div class="image-side">
      <div class="image-top-diffuse" aria-hidden="true"></div>
      <div class="hero-carousel" id="hero-carousel" role="region" aria-label="Showcase photos">
        <div class="hero-slide active" data-index="0">
          <img src="cleanuptransformation.jpg" alt="Cleanup transformation image" />
        </div>
        <div class="hero-slide" data-index="1">
          <img src="IMG_3541.png" alt="Cleaning crew wiping down stainless steel surfaces" />
        </div>
        <div class="hero-slide" data-index="2">
          <img src="IMG_1629.png" alt="Freshly cleaned office lobby with seating area" />
        </div>
        <div class="hero-slide" data-index="3">
          <img src="IMG_1487.png" alt="Sanitized kitchen counter shining under lights" />
        </div>
        <div class="hero-dots" role="tablist" aria-label="Hero image navigation">
          <button type="button" class="hero-dot active" aria-label="Cleanup transformation image" role="tab"></button>
          <button type="button" class="hero-dot" aria-label="Cleaning crew wiping down stainless steel surfaces" role="tab"></button>
          <button type="button" class="hero-dot" aria-label="Freshly cleaned office lobby with seating area" role="tab"></button>
          <button type="button" class="hero-dot" aria-label="Sanitized kitchen counter shining under lights" role="tab"></button>
        </div>
      </div>
    </div>
  </section>

  <!-- SERVICES -->
  <section id="services" class="services-page">
    <div class="services-header">
      <h1>our services</h1>
      <p>Professional cleaning solutions tailored to your needs. From warehouses to offices, we deliver exceptional results every time.</p>
    </div>

    <div class="services-grid">
      <a class="service-card" href="book.html?pkg=industrial&service=Industrial%20%26%20Warehouse%20Deep%20Clean#start">
        <img src="img/warehouse-deep-clean.jpg" alt="Warehouse deep cleaning with floor scrubber and high-dusting" class="service-image" />
        <h3>industrial &amp; warehouse deep clean</h3>
        <p>Heavy-duty cleaning for aisles, docks, and production floors‚Äîdegreasing, machine wipe-downs, and high-dusting of beams &amp; racking.</p>
        <span class="service-cta">book this</span>
      </a>

      <a class="service-card" href="book.html?pkg=office&service=Office%20Deep%20Clean#start">
        <img src="img/office-deep-clean.jpg" alt="Office deep clean: tidy desks, mopped floors, stocked restrooms" class="service-image" />
        <h3>office deep clean</h3>
        <p>Workstations, meeting rooms, and common areas‚Äîvacuum &amp; mop, bin service &amp; recycling, restroom sanitization and supply refill.</p>
        <span class="service-cta">book this</span>
      </a>

      <a class="service-card" href="book.html?pkg=specialty&service=High-Reach%20Window%20%26%20Rail%20Cleaning%20(Scissor%20Lift)%20%E2%80%94%20Warehouses#start">
        <img src="img/highreach-warehouse.jpg" alt="Scissor-lift crew cleaning warehouse high windows and rails" class="service-image" />
        <h3>high-reach window &amp; rail (warehouses)</h3>
        <p>Clear glass and safe rails at height‚Äîperformed with scissor lifts (no rope-access). Frames, tracks, and mezzanine rails detailed and sanitized.</p>
        <span class="service-cta">book this</span>
      </a>
    </div>
  </section>

  <!-- ABOUT (restored) -->
  <section id="about" class="about-section">
    <div class="about-inner">
      <div class="about-content">
        <p class="about-intro">A quick reminder of who we are</p>
        <h2 class="about-title">
          <span class="about-script">about us</span>
        </h2>
        <p class="about-slogan">We scrub with heart so your team can focus on what matters.</p>
        <p class="about-description">
          <span>Family-built, people-first cleaning crews who respect every facility we enter.</span>
          <span>We show up on time, finish the tough jobs, and leave every surface ready to shine.</span>
          <span>Trusted by Homeowners, Offices and warehouses across Ontario. Get a free, no-obligation quote within one business day.</span>
        </p>
      </div>
      <div class="about-soap" aria-hidden="true">üßº</div>
    </div>
  </section>

  <!-- Quote logic -->
  <script>
    (function(){
      const quoteForms = Array.from(document.querySelectorAll('form.quote-form'));
      if(!quoteForms.length) return;

      const basePricing = {
        home: {
          '1000-1500': 165,
          '1500-2000': 185,
          '2000-2500': 215,
          '2500-3000': 245,
          '3000-3500': 285,
          '3500-4000': 325
        },
        commercial: {
          '1000-1500': 240,
          '1500-2000': 285,
          '2000-2500': 330,
          '2500-3000': 380,
          '3000-3500': 425,
          '3500-4000': 470
        },
        office: {
          '1000-1500': 210,
          '1500-2000': 250,
          '2000-2500': 295,
          '2500-3000': 335,
          '3000-3500': 375,
          '3500-4000': 420
        }
      };

      const detailPricing = {
        home: {
          rooms: { '1-2': 0, '3-4': 25, '5-6': 55, '7+': 85 },
          bathrooms: { '1': 0, '2': 18, '3': 36, '4+': 54 },
          pets: { no: 0, yes: 25 },
          basement: { no: 0, yes: 45 },
          basementRooms: { '1-2': 25, '3-4': 45, '5+': 65 },
          basementBathrooms: { '1': 18, '2': 32, '3+': 46 }
        },
        office: {
          offices: { '1-5': 0, '6-10': 45, '11-20': 90, '21+': 135 },
          bathrooms: { '1-2': 0, '3-4': 40, '5+': 70 }
        }
      };

      quoteForms.forEach(setupQuoteForm);

      function setupQuoteForm(form){
        const requiredFields = Array.from(form.querySelectorAll('[data-required]'));
        const basePriceEl = form.querySelector('[data-quote-base]');
        const detailRow = form.querySelector('[data-quote-detail-row]');
        const detailPriceEl = form.querySelector('[data-quote-detail]');
        const totalPriceEl = form.querySelector('[data-quote-total]');
        const serviceInput = form.querySelector('[name="service"]');
        const sqftInput = form.querySelector('[name="square-footage"]');
        const serviceDetailsWrapper = form.querySelector('.service-details');
        const detailGroups = serviceDetailsWrapper ? Array.from(serviceDetailsWrapper.querySelectorAll('[data-service-detail]')) : [];
        const seePriceBtn = form.querySelector('.quote-see-price');
        const pillControls = Array.from(form.querySelectorAll('[data-target-input]'));
        const numberFields = Array.from(form.querySelectorAll('input[type="number"][data-detail-key]'));
        const basementField = form.querySelector('[name="home-basement"]');
        const basementExtras = form.querySelector('[data-basement-extra]');
        const basementExtraNumbers = basementExtras ? Array.from(basementExtras.querySelectorAll('input[type="number"]')) : [];
        const basementRoomsField = form.querySelector('[name="home-basement-rooms"]');
        const basementBathsField = form.querySelector('[name="home-basement-bathrooms"]');

        function formatCountLabel(count, input){
          if(!input) return `${count}`;
          const singular = input.dataset.labelPrefix || '';
          if(!singular) return `${count}`;
          const plural = input.dataset.labelPlural;
          const fallbackPlural = plural || (singular.endsWith('s') ? `${singular}es` : `${singular}s`);
          const word = count === 1 ? singular : (plural || fallbackPlural);
          return `${count} ${word}`;
        }

        function mapHomeRooms(count, input){
          const label = formatCountLabel(count, input);
          if(count <= 2) return { key: '1-2', label };
          if(count <= 4) return { key: '3-4', label };
          if(count <= 6) return { key: '5-6', label };
          return { key: '7+', label };
        }

        function mapHomeBathrooms(count, input){
          const label = formatCountLabel(count, input);
          if(count <= 1) return { key: '1', label };
          if(count <= 2) return { key: '2', label };
          if(count <= 3) return { key: '3', label };
          return { key: '4+', label };
        }

        function mapBasementRooms(count, input){
          const label = formatCountLabel(count, input);
          if(count <= 2) return { key: '1-2', label };
          if(count <= 4) return { key: '3-4', label };
          return { key: '5+', label };
        }

        function mapBasementBathrooms(count, input){
          const label = formatCountLabel(count, input);
          if(count <= 1) return { key: '1', label };
          if(count <= 2) return { key: '2', label };
          return { key: '3+', label };
        }

        function detailMapperFor(input){
          if(!input) return null;
          const key = input.dataset.detailKey;
          if(key === 'homeRooms') return mapHomeRooms;
          if(key === 'homeBathrooms') return mapHomeBathrooms;
          if(key === 'homeBasementRooms') return mapBasementRooms;
          if(key === 'homeBasementBathrooms') return mapBasementBathrooms;
          return null;
        }

        function updateNumberMeta(input){
          if(!input) return;
          const raw = input.value ? input.value.trim() : '';
          if(!raw){
            input.dataset.label = '';
            input.dataset.pricingKey = '';
            return;
          }
          const count = Number(raw);
          if(!Number.isFinite(count) || count <= 0){
            input.dataset.label = '';
            input.dataset.pricingKey = '';
            return;
          }
          const mapper = detailMapperFor(input);
          const mapping = mapper ? mapper(count, input) : null;
          if(mapping){
            input.dataset.label = mapping.label;
            input.dataset.pricingKey = mapping.key || '';
          } else {
            input.dataset.label = formatCountLabel(count, input);
            input.dataset.pricingKey = '';
          }
        }

        function numberSelection(input){
          if(!input) return null;
          updateNumberMeta(input);
          const raw = input.value ? input.value.trim() : '';
          if(!raw) return null;
          const count = Number(raw);
          if(!Number.isFinite(count) || count <= 0) return null;
          const label = input.dataset.label || formatCountLabel(count, input);
          const key = input.dataset.pricingKey || '';
          return { value: raw, label, key };
        }

        function dependencySatisfied(field){
          const dependencyName = field.dataset.dependentOn;
          if(!dependencyName) return true;
          const dependencyField = form.querySelector(`[name="${dependencyName}"]`);
          if(!dependencyField) return false;
          const expected = (field.dataset.dependentValue || '').split(',').map(val => val.trim()).filter(Boolean);
          const actual = dependencyField.value || '';
          if(expected.length){
            return expected.includes(actual);
          }
          return actual !== '';
        }

        function fieldIsRelevant(field){
          const requirement = field.dataset.serviceRequired;
          if(requirement){
            const serviceKey = serviceInput ? serviceInput.value : '';
            if(!serviceKey) return false;
            if(!requirement.split(',').includes(serviceKey)) return false;
          }
          return dependencySatisfied(field);
        }

        function hasAllRequired(){
          return requiredFields.every(field => {
            if(!fieldIsRelevant(field)) return true;
            const value = field.value ? field.value.trim() : '';
            if(field.type === 'email'){
              return value !== '' && value.includes('@');
            }
            if(field.type === 'number'){
              if(value === '') return false;
              const numeric = Number(value);
              if(!Number.isFinite(numeric) || numeric <= 0) return false;
              if(field.min !== '' && !Number.isNaN(Number(field.min)) && numeric < Number(field.min)) return false;
              return true;
            }
            return value !== '';
          });
        }

        function resetServiceGroup(group){
          const hiddenInputs = Array.from(group.querySelectorAll('input[type="hidden"]'));
          hiddenInputs.forEach(input => {
            input.value = '';
            input.dataset.label = '';
          });
          const selects = Array.from(group.querySelectorAll('select'));
          selects.forEach(select => {
            select.selectedIndex = 0;
          });
          const numbers = Array.from(group.querySelectorAll('input[type="number"]'));
          numbers.forEach(input => {
            input.value = '';
            input.dataset.label = '';
            input.dataset.pricingKey = '';
          });
          const buttons = Array.from(group.querySelectorAll('[data-target-input]'));
          buttons.forEach(btn => {
            btn.classList.remove('active');
            btn.setAttribute('aria-pressed', 'false');
          });
          const basementExtras = Array.from(group.querySelectorAll('[data-basement-extra]'));
          basementExtras.forEach(extra => {
            extra.hidden = true;
            extra.classList.remove('visible');
            extra.setAttribute('aria-hidden', 'true');
          });
        }

        function updateServiceDetails(serviceKey){
          if(!serviceDetailsWrapper) return;
          let activeCount = 0;
          detailGroups.forEach(group => {
            const services = (group.dataset.serviceDetail || '').split(',');
            const match = serviceKey && services.includes(serviceKey);
            group.classList.toggle('active', !!match);
            group.setAttribute('aria-hidden', match ? 'false' : 'true');
            if(match){
              activeCount += 1;
            } else {
              resetServiceGroup(group);
            }
          });
          serviceDetailsWrapper.classList.toggle('visible', activeCount > 0);
          serviceDetailsWrapper.setAttribute('aria-hidden', activeCount > 0 ? 'false' : 'true');
          syncBasementExtras(serviceKey);
        }

        function setBasementExtrasVisible(show){
          if(!basementExtras) return;
          if(show){
            basementExtras.hidden = false;
            basementExtras.classList.add('visible');
            basementExtras.setAttribute('aria-hidden', 'false');
            basementExtraNumbers.forEach(updateNumberMeta);
          } else {
            basementExtras.hidden = true;
            basementExtras.classList.remove('visible');
            basementExtras.setAttribute('aria-hidden', 'true');
            basementExtraNumbers.forEach(input => {
              input.value = '';
              input.dataset.label = '';
              input.dataset.pricingKey = '';
              updateNumberMeta(input);
            });
          }
        }

        function syncBasementExtras(serviceKey){
          if(!basementField){
            setBasementExtrasVisible(false);
            return;
          }
          const shouldShow = serviceKey === 'home' && basementField.value === 'yes';
          setBasementExtrasVisible(shouldShow);
        }

        function selectionInfo(input){
          if(!input || !input.value) return null;
          return {
            value: input.value,
            label: resolveLabel(input)
          };
        }

        function resolveLabel(input){
          if(!input) return '';
          if(input.tagName === 'SELECT'){
            const option = input.options[input.selectedIndex];
            if(option){
              return option.dataset.label || option.textContent.trim();
            }
            return '';
          }
          if(input.dataset && input.dataset.label){
            return input.dataset.label;
          }
          return input.value || '';
        }

        function calculateTotals(){
          const serviceKey = serviceInput ? serviceInput.value : '';
          const sqftKey = sqftInput ? sqftInput.value : '';
          if(!serviceKey || !sqftKey || !basePricing[serviceKey]){
            return { ready: false, base: 0, detail: 0, total: 0, selections: {}, serviceLabel: '', sqftLabel: '' };
          }

          const base = basePricing[serviceKey][sqftKey] || 0;
          let detailAdjustment = 0;
          const selections = {};

          if(serviceKey === 'home'){
            const roomsField = form.querySelector('[name="home-rooms"]');
            const bathsField = form.querySelector('[name="home-bathrooms"]');
            const petsField = form.querySelector('[name="home-pets"]');

            const roomsInfo = numberSelection(roomsField);
            const bathsInfo = numberSelection(bathsField);
            const petsInfo = selectionInfo(petsField);
            const basementInfo = selectionInfo(basementField);
            const basementRoomsInfo = basementInfo && basementInfo.value === 'yes' ? numberSelection(basementRoomsField) : null;
            const basementBathsInfo = basementInfo && basementInfo.value === 'yes' ? numberSelection(basementBathsField) : null;

            if(roomsInfo){
              if(roomsInfo.key){ detailAdjustment += detailPricing.home.rooms[roomsInfo.key] || 0; }
              selections.homeRooms = { value: roomsInfo.value, label: roomsInfo.label };
            }
            if(bathsInfo){
              if(bathsInfo.key){ detailAdjustment += detailPricing.home.bathrooms[bathsInfo.key] || 0; }
              selections.homeBathrooms = { value: bathsInfo.value, label: bathsInfo.label };
            }
            if(petsInfo){
              detailAdjustment += detailPricing.home.pets[petsInfo.value] || 0;
              selections.homePets = petsInfo;
            }
            if(basementInfo){
              const basementPricing = detailPricing.home.basement || {};
              if(Object.prototype.hasOwnProperty.call(basementPricing, basementInfo.value)){
                detailAdjustment += basementPricing[basementInfo.value] || 0;
              }
              selections.homeBasement = basementInfo;
            }
            if(basementRoomsInfo){
              if(basementRoomsInfo.key){ detailAdjustment += detailPricing.home.basementRooms[basementRoomsInfo.key] || 0; }
              selections.homeBasementRooms = { value: basementRoomsInfo.value, label: basementRoomsInfo.label };
            }
            if(basementBathsInfo){
              if(basementBathsInfo.key){ detailAdjustment += detailPricing.home.basementBathrooms[basementBathsInfo.key] || 0; }
              selections.homeBasementBathrooms = { value: basementBathsInfo.value, label: basementBathsInfo.label };
            }
          }

          if(serviceKey === 'office'){
            const officesField = form.querySelector('[name="office-offices"]');
            const officeBathsField = form.querySelector('[name="office-bathrooms"]');

            const officesInfo = selectionInfo(officesField);
            const officeBathsInfo = selectionInfo(officeBathsField);

            if(officesInfo){
              detailAdjustment += detailPricing.office.offices[officesInfo.value] || 0;
              selections.officeOffices = officesInfo;
            }
            if(officeBathsInfo){
              detailAdjustment += detailPricing.office.bathrooms[officeBathsInfo.value] || 0;
              selections.officeBathrooms = officeBathsInfo;
            }
          }

          return {
            ready: true,
            base,
            detail: detailAdjustment,
            total: base + detailAdjustment,
            selections,
            serviceLabel: resolveLabel(serviceInput) || serviceKey,
            sqftLabel: resolveLabel(sqftInput) || sqftKey
          };
        }

        function formatCurrency(value){
          if(!value) return '‚Äî';
          return `$${Math.round(value)}`;
        }

        function updateTotals(){
          const totals = calculateTotals();

          if(basePriceEl){ basePriceEl.textContent = totals.ready ? formatCurrency(totals.base) : '‚Äî'; }
          if(totalPriceEl){ totalPriceEl.textContent = totals.ready ? formatCurrency(totals.total) : '‚Äî'; }

          if(detailRow && detailPriceEl){
            if(totals.ready && totals.detail > 0){
              detailRow.hidden = false;
              detailPriceEl.textContent = `+$${Math.round(totals.detail)}`;
            } else {
              detailRow.hidden = true;
              detailPriceEl.textContent = '‚Äî';
            }
          }

          const ready = totals.ready && hasAllRequired();
          form.classList.toggle('quote-ready', ready);
          if(seePriceBtn){ seePriceBtn.disabled = !ready; }

          return totals;
        }

        pillControls.forEach(control => {
          const targetName = control.dataset.targetInput;
          if(!targetName) return;
          const hiddenInput = form.querySelector(`input[name="${targetName}"]`);
          if(!hiddenInput) return;

          control.setAttribute('aria-pressed', 'false');

          control.addEventListener('click', () => {
            const group = control.closest('[role="radiogroup"]') || control.parentElement;
            if(group){
              Array.from(group.querySelectorAll('[data-target-input="' + targetName + '"]')).forEach(btn => {
                const active = btn === control;
                btn.classList.toggle('active', active);
                btn.setAttribute('aria-pressed', active ? 'true' : 'false');
              });
            }

            hiddenInput.value = control.dataset.value || '';
            hiddenInput.dataset.label = control.dataset.label || hiddenInput.value;
            hiddenInput.dispatchEvent(new Event('change', { bubbles: true }));
            updateServiceDetails(serviceInput ? serviceInput.value : '');
            updateTotals();
          });
        });

        requiredFields.forEach(field => {
          const isSelect = field.tagName === 'SELECT';
          const eventName = isSelect ? 'change' : 'input';
          const handler = () => {
            if(field.type === 'number'){
              updateNumberMeta(field);
            }
            updateTotals();
          };
          field.addEventListener(eventName, handler);
        });

        numberFields.forEach(updateNumberMeta);

        if(basementField){
          basementField.addEventListener('change', () => {
            syncBasementExtras(serviceInput ? serviceInput.value : '');
            updateTotals();
          });
        }

        if(serviceInput){
          serviceInput.addEventListener('change', () => {
            updateServiceDetails(serviceInput.value);
            updateTotals();
          });
        }

        if(sqftInput){
          sqftInput.addEventListener('change', updateTotals);
        }

        if(seePriceBtn){
          seePriceBtn.addEventListener('click', () => {
            if(seePriceBtn.disabled) return;
            const totals = updateTotals();
            if(!totals.ready) return;

            const mode = form.dataset.quoteMode || 'redirect';
            if(mode !== 'redirect') return;

            const redirectTarget = form.dataset.redirect || 'book.html';
            const url = new URL(redirectTarget, window.location.origin);
            const params = url.searchParams;

            const serviceValue = serviceInput ? serviceInput.value : '';
            if(serviceValue){
              params.set('service', serviceValue);
              if(totals.serviceLabel){ params.set('serviceLabel', totals.serviceLabel); }
            }

            const sqftValue = sqftInput ? sqftInput.value : '';
            if(sqftValue){
              params.set('sqft', sqftValue);
              if(totals.sqftLabel){ params.set('sqftLabel', totals.sqftLabel); }
            }

            params.set('basePrice', totals.base.toFixed(2));
            params.set('detailPrice', totals.detail.toFixed(2));
            params.set('total', totals.total.toFixed(2));

            const firstName = form.querySelector('input[name="first-name"]');
            if(firstName && firstName.value.trim()){
              params.set('firstName', firstName.value.trim());
            }

            const email = form.querySelector('input[name="email"]');
            if(email && email.value.trim()){
              params.set('email', email.value.trim());
            }

            Object.entries(totals.selections || {}).forEach(([key, info]) => {
              if(info.value){ params.set(key, info.value); }
              if(info.label){ params.set(`${key}Label`, info.label); }
            });

            const anchor = form.dataset.redirectAnchor;
            const finalUrl = anchor ? `${url.toString()}#${anchor}` : url.toString();
            window.location.href = finalUrl;
          });
        }

        updateServiceDetails(serviceInput ? serviceInput.value : '');
        syncBasementExtras(serviceInput ? serviceInput.value : '');
        updateTotals();
      }
    })();
  </script>

  <script>
    (function(){
      const navQuoteLink = document.querySelector('.nav-links .quote-btn');
      const quoteSection = document.getElementById('quote');
      if(!navQuoteLink || !quoteSection) return;

      let spotlightTimer = null;

      navQuoteLink.addEventListener('click', (event) => {
        if(event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) return;
        if(typeof event.button === 'number' && event.button !== 0) return;
        event.preventDefault();
        quoteSection.classList.remove('quote-spotlight');
        void quoteSection.offsetWidth;
        quoteSection.classList.add('quote-spotlight');
        quoteSection.scrollIntoView({ behavior: 'smooth', block: 'center' });

        const focusTarget = quoteSection.querySelector('input, button');
        if(focusTarget){
          try {
            focusTarget.focus({ preventScroll: true });
          } catch(_){
            focusTarget.focus();
          }
        }

        if(spotlightTimer){
          window.clearTimeout(spotlightTimer);
        }

        spotlightTimer = window.setTimeout(() => {
          quoteSection.classList.remove('quote-spotlight');
          spotlightTimer = null;
        }, 1600);
      });
    })();
  </script>

  <!-- iOS detector -->
  <script>
    (function () {
      var iOS =
        /iP(hone|od|ad)/.test(navigator.platform) ||
        (navigator.userAgent.includes('Mac') && navigator.maxTouchPoints > 1);
      if (iOS) document.documentElement.classList.add('ios');
    })();
  </script>

  <!-- Hero image carousel -->
  <script>
    (function(){
      const carousel = document.getElementById('hero-carousel');
      if(!carousel) return;

      const slides = Array.from(carousel.querySelectorAll('.hero-slide'));
      const dots = Array.from(carousel.querySelectorAll('.hero-dot'));
      let index = 0;
      let timer = null;

      function setActive(next){
        slides[index].classList.remove('active');
        slides[index].setAttribute('aria-hidden', 'true');
        dots[index].classList.remove('active');
        dots[index].setAttribute('aria-selected', 'false');

        index = (next + slides.length) % slides.length;

        slides[index].classList.add('active');
        slides[index].setAttribute('aria-hidden', 'false');
        dots[index].classList.add('active');
        dots[index].setAttribute('aria-selected', 'true');
      }

      function next(){ setActive(index + 1); }

      function start(){ stop(); timer = setInterval(next, 5000); }
      function stop(){ if(timer){ clearInterval(timer); timer = null; } }

      dots.forEach((dot, i)=>{
        dot.addEventListener('click', ()=>{ setActive(i); start(); });
        dot.addEventListener('keydown', (evt)=>{
          if(evt.key === 'Enter' || evt.key === ' '){ evt.preventDefault(); setActive(i); start(); }
        });
      });

      carousel.addEventListener('mouseenter', stop);
      carousel.addEventListener('mouseleave', start);
      carousel.addEventListener('touchstart', stop, {passive:true});
      carousel.addEventListener('touchend', ()=>{ start(); }, {passive:true});

      slides.forEach((slide, i)=> slide.setAttribute('aria-hidden', i === index ? 'false' : 'true'));
      dots.forEach((dot, i)=> dot.setAttribute('aria-selected', i === index ? 'true' : 'false'));
      setActive(0);
      start();
    })();
  </script>

</body>
</html>
