<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>DufferinDeepClean</title>

  <!-- Favicons / PWA -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="DeepClean" />
  <link rel="manifest" href="/site.webmanifest" />

  <!-- Fonts + CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Great+Vibes&family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />

  <!-- Page-specific tweaks (safe to keep inline) -->
  <style>
    /* keep sections above animated bg from style.css */
    .navbar, .announcement, .split-screen, .services-page, .about-section, main, section, footer { position:relative; z-index:2; }

    /* Transparent header over infinite bg */
    .navbar{
      background: rgba(0,0,0,0.25) !important;
      backdrop-filter: blur(6px);
      border-bottom: 1px solid rgba(255,255,255,0.07);
    }

    /* Logo: match ‚Äúabout us‚Äù font + left‚Üíright reveal + bigger */
    @keyframes logoUnveil{0%{clip-path:inset(0 100% 0 0);opacity:0}40%{opacity:1}100%{clip-path:inset(0 0 0 0);opacity:1}}
    @keyframes logoSweep{0%{opacity:1;transform:translateX(-105%)}60%{opacity:.75}100%{opacity:0;transform:translateX(120%)}}
    .logo .logo-text{
      font-family: 'Great Vibes', cursive !important;
      font-size: 2.8rem !important;
      letter-spacing: .5px;
      color:#fff !important;
      position:relative;
      display:inline-block;
      clip-path: inset(0 100% 0 0);
      opacity:0; animation: logoUnveil 1.1s ease forwards .25s;
    }
    .logo .logo-text::after{
      content:""; position:absolute; inset:0;
      background: linear-gradient(90deg, rgba(0,212,255,.85), rgba(255,255,255,.95));
      mix-blend-mode: screen; opacity:0; pointer-events:none;
      animation: logoSweep 1.1s ease forwards .25s;
    }

    /* Nav links in same script font */
    .nav-links a{
      font-family:'Great Vibes', cursive !important;
      font-size:1.6rem !important;
      letter-spacing:.02em;
      color:#f6fbff;
    }

    /* Hero image flush to right edge */
    .image-side img{
      transform:none !important;
      object-position: right center !important;
    }

    /* ===== Rotator card (with slide animations) ===== */
    .rotator-card{
      margin-top: 1.25rem;
      padding: 1.4rem 1.6rem;
      max-width: 560px;
      border-radius: 20px;
      border:1px solid rgba(0,212,255,0.25);
      background: rgba(0,0,0,0.55);
      box-shadow: 0 20px 60px rgba(0,0,0,0.45), 0 0 22px rgba(0,212,255,0.12);
      backdrop-filter: blur(8px);
      overflow: hidden;
      position: relative;
    }
    .rotator-window{ position:relative; height:auto; min-height: 84px; }
    .rotator-line{
      position:absolute; left:0; top:0; width:100%;
      opacity:0; transform: translateX(24px);
      transition: transform .45s ease, opacity .45s ease;
      will-change: transform, opacity;
    }
    .rotator-line.active{ opacity:1; transform: translateX(0); }
    .rotator-title{
      display:block; font-family:'Bebas Neue',sans-serif; text-transform:uppercase;
      letter-spacing:.08em; font-size:1.05rem; color:rgba(0,212,255,0.85); margin-bottom:.25rem;
    }
    .rotator-text{ display:block; font-size:1.2rem; line-height:1.65; color:#d8ecff; }

    .rotator-underline{
      display:block; height:3px; width:100%; border-radius:999px; margin-top:.75rem;
      background:linear-gradient(90deg, rgba(0,212,255,0), rgba(0,212,255,.85), rgba(255,255,255,0));
      transform-origin:left center; animation: underlineGrow .6s ease both;
    }
    @keyframes underlineGrow{ from{ transform:scaleX(0); opacity:.4;} to{ transform:scaleX(1); opacity:1;} }

    .rotator-dots{ display:flex; gap:.5rem; margin-top:.45rem; }
    .rotator-dots .dot{
      width:10px; height:10px; border-radius:50%; border:1.5px solid #00d4ff;
      background:transparent; opacity:.7; cursor:pointer;
      transition: transform .2s ease, opacity .2s ease, background-color .2s ease;
    }
    .rotator-dots .dot.active{ background:#00d4ff; opacity:1; transform:scale(1.05); }

    /* Slight nudge of whole card on change for ‚Äúbox is moving‚Äù feel */
    .rotator-card.bump{ animation: cardBump .35s ease; }
    @keyframes cardBump{ 0%{ transform:translateX(0);} 40%{ transform:translateX(6px);} 100%{ transform:translateX(0);} }

    /* ===== ABOUT (restored) ===== */
    .about-section { padding: 6em 2em 7em; }
    .about-inner{
      max-width:1100px; margin:0 auto; display:flex; align-items:flex-start; justify-content:space-between; gap:3rem;
      background: rgba(0,0,0,0.55); border: 1px solid rgba(0,212,255,0.25); border-radius: 28px; padding: 3em;
      box-shadow: 0 40px 90px rgba(0,0,0,0.45); position:relative;
    }
    .about-intro{ letter-spacing:.35rem; font-size:.85rem; text-transform:uppercase; color:rgba(0,212,255,0.75); margin-bottom:1rem; }
    .about-title{ margin-bottom:1.2rem; position:relative; }
    .about-script{ font-family:'Great Vibes', cursive; font-size:4rem; text-transform:lowercase; color:#f3fbff; letter-spacing:.1rem; position:relative; }
    .about-script::after{
      content:""; position:absolute; left:0; bottom:-6px; height:4px; width:100%;
      background: linear-gradient(90deg, rgba(0,212,255,0) 0%, rgba(0,212,255,0.8) 35%, rgba(0,212,255,1) 55%, rgba(0,212,255,0) 100%);
      border-radius:999px; transform-origin:left center; animation: underlineGrow .7s ease .3s both;
    }
    .about-slogan{ font-size:1.35rem; color:#d2ebff; line-height:1.6; margin-bottom:1.75rem; max-width:28ch; }
    .about-description{ display:grid; gap:1rem; color:#cfe9ff; font-size:1.05rem; line-height:1.7; }
    .about-soap{
      font-size:5rem; color:#00d4ff; position:absolute; left:76%; top:58%;
      transform:translate(-50%,-50%); pointer-events:none; z-index:2;
    }
    .about-soap::before{
      content:""; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
      width:220px; height:220px; border-radius:50%;
      background: radial-gradient(circle, rgba(0,212,255,.38) 0%, rgba(0,212,255,0) 70%);
      filter: blur(20px); z-index:-1;
    }

    /* iOS-only quick fixes keep working via style.css rules */
  </style>
</head>
<body>

  <!-- NAVIGATION -->
  <header class="navbar">
    <div class="logo">
      <span class="soap">üßº</span>
      <a class="logo-text" href="/">DufferinDeepClean</a>
    </div>
    <nav class="nav-links">
      <a href="#home">Home</a>
      <a href="#services">Services</a>
      <a href="#about">About Us</a>
      <a href="book.html#start" class="quote-btn">Book Online</a>
    </nav>
  </header>

  <!-- Announcement -->
  <div class="announcement" role="region" aria-label="Promotion">
    <div class="announcement-inner">
      <p class="announce-line">999-999-999</p>
      <a class="announcement-cta" href="tel:+1999999999">Call Today</a>
    </div>
  </div>

  <!-- HERO -->
  <section id="home" class="split-screen">
    <div class="text-side">
      <div class="rotator-card" id="service-rotator">
        <div class="rotator-window" aria-live="polite">
          <div class="rotator-line active" data-title="Residential Homes">
            <span class="rotator-title">Residential Homes</span>
            <span class="rotator-text">We don‚Äôt just tidy houses. We deep clean homes.</span>
          </div>
          <div class="rotator-line" data-title="Commercial Buildings">
            <span class="rotator-title">Commercial Buildings</span>
            <span class="rotator-text">Commercial spaces collect more than dust. We remove it all.</span>
          </div>
          <div class="rotator-line" data-title="Offices / Workspaces">
            <span class="rotator-title">Offices / Workspaces</span>
            <span class="rotator-text">Clean offices look professional. Deep clean offices stay professional.</span>
          </div>
        </div>
        <span class="rotator-underline" aria-hidden="true"></span>
        <div class="rotator-dots" role="tablist" aria-label="Service types">
          <button class="dot active" aria-label="Residential Homes" role="tab"></button>
          <button class="dot" aria-label="Commercial Buildings" role="tab"></button>
          <button class="dot" aria-label="Offices / Workspaces" role="tab"></button>
        </div>
      </div>

      <div id="quote" class="hero-quote" aria-labelledby="quote-title">
        <div class="quote-card">
          <div class="quote-card-header">
            <h2 id="quote-title">custom cleaning quote</h2>
            <p>Answer a few quick questions to unlock a tailored estimate for your space.</p>
          </div>

          <form id="instant-quote" class="quote-form" data-quote-mode="redirect" data-redirect="book.html" data-redirect-anchor="start" novalidate>
            <div class="quote-grid">
              <label class="field" for="quote-first-name">
                <span class="field-label">First Name</span>
                <input id="quote-first-name" name="first-name" type="text" placeholder="e.g. Jordan" autocomplete="given-name" data-required>
              </label>

              <label class="field" for="quote-email">
                <span class="field-label">Email</span>
                <input id="quote-email" name="email" type="email" placeholder="you@example.com" autocomplete="email" data-required>
              </label>

              <label class="field field-inline" for="quote-service">
                <span class="field-label">Type of Service</span>
                <div class="select-wrap">
                  <select id="quote-service" name="service" data-required>
                    <option value="" disabled selected>Select a service</option>
                    <option value="home">Home General Cleaning</option>
                    <option value="commercial">Factory / Commercial / Industrial Cleaning</option>
                    <option value="office">Office Workspace Cleaning</option>
                  </select>
                </div>
              </label>

              <label class="field field-inline" for="quote-sqft">
                <span class="field-label">Square Footage</span>
                <div class="select-wrap">
                  <select id="quote-sqft" name="square-footage" data-required>
                    <option value="" disabled selected>Select an approximate size</option>
                    <option value="1000-1500">1,000 ‚Äì 1,500 sq ft</option>
                    <option value="1500-2000">1,500 ‚Äì 2,000 sq ft</option>
                    <option value="2000-2500">2,000 ‚Äì 2,500 sq ft</option>
                    <option value="2500-3000">2,500 ‚Äì 3,000 sq ft</option>
                    <option value="3000-3500">3,000 ‚Äì 3,500 sq ft</option>
                    <option value="3500-4000">3,500 ‚Äì 4,000 sq ft</option>
                  </select>
                </div>
              </label>
            </div>

            <div class="quote-summary" aria-live="polite">
              <div class="quote-summary-line">
                <span>Base Package</span>
                <strong id="quote-base-price">‚Äî</strong>
              </div>
              <div class="quote-summary-line" id="quote-detail-row" hidden>
                <span>Service Details</span>
                <strong id="quote-detail-price">‚Äî</strong>
              </div>
              <div class="quote-summary-line total">
                <span>Estimated Visit Total</span>
                <strong id="quote-total-price">‚Äî</strong>
              </div>
            </div>

            <div id="service-details" class="service-details" aria-live="polite">
              <div class="service-detail-group" data-service-detail="home" aria-hidden="true">
                <p class="service-detail-title">Home Cleaning Details</p>
                <div class="service-detail-grid">
                  <label class="field" for="home-rooms">
                    <span class="field-label">Number of Rooms</span>
                    <select id="home-rooms" name="home-rooms" data-required data-service-required="home">
                      <option value="" disabled selected>Select rooms</option>
                      <option value="1-2">1 ‚Äì 2 rooms</option>
                      <option value="3-4">3 ‚Äì 4 rooms</option>
                      <option value="5-6">5 ‚Äì 6 rooms</option>
                      <option value="7+">7+ rooms</option>
                    </select>
                  </label>
                  <label class="field" for="home-bathrooms">
                    <span class="field-label">Number of Bathrooms</span>
                    <select id="home-bathrooms" name="home-bathrooms" data-required data-service-required="home">
                      <option value="" disabled selected>Select bathrooms</option>
                      <option value="1">1 bathroom</option>
                      <option value="2">2 bathrooms</option>
                      <option value="3">3 bathrooms</option>
                      <option value="4+">4+ bathrooms</option>
                    </select>
                  </label>
                  <div class="field field-choice">
                    <span class="field-label">Are there pets?</span>
                    <div class="choice-buttons" role="group" aria-label="Are there pets?">
                      <button type="button" class="choice-button" data-value="no" data-target="home-pets">No</button>
                      <button type="button" class="choice-button" data-value="yes" data-target="home-pets">Yes</button>
                    </div>
                    <input type="hidden" id="home-pets" name="home-pets" data-required data-service-required="home">
                  </div>
                </div>
              </div>

              <div class="service-detail-group" data-service-detail="office" aria-hidden="true">
                <p class="service-detail-title">Office Workspace Details</p>
                <div class="service-detail-grid">
                  <label class="field" for="office-offices">
                    <span class="field-label">Number of Offices</span>
                    <select id="office-offices" name="office-offices" data-required data-service-required="office">
                      <option value="" disabled selected>Select offices</option>
                      <option value="1-5">1 ‚Äì 5 offices</option>
                      <option value="6-10">6 ‚Äì 10 offices</option>
                      <option value="11-20">11 ‚Äì 20 offices</option>
                      <option value="21+">21+ offices</option>
                    </select>
                  </label>
                  <label class="field" for="office-bathrooms">
                    <span class="field-label">Number of Bathrooms</span>
                    <select id="office-bathrooms" name="office-bathrooms" data-required data-service-required="office">
                      <option value="" disabled selected>Select bathrooms</option>
                      <option value="1-2">1 ‚Äì 2 bathrooms</option>
                      <option value="3-4">3 ‚Äì 4 bathrooms</option>
                      <option value="5+">5+ bathrooms</option>
                    </select>
                  </label>
                </div>
              </div>
            </div>

            <div class="quote-actions">
              <button type="button" id="quote-see-price" class="quote-see-price" disabled>See My Price</button>
            </div>
          </form>
        </div>
      </div>

      <a href="tel:+1999999999" class="quote-btn-home">Call Now</a>
      <a href="#services" class="services-btn-home">Our Services</a>
    </div>

    <div class="image-side">
      <div class="image-top-diffuse" aria-hidden="true"></div>
      <div class="hero-carousel" id="hero-carousel" role="region" aria-label="Showcase photos">
        <div class="hero-slide active" data-index="0">
          <img src="cleanuptransformation.jpg" alt="Cleanup transformation image" />
        </div>
        <div class="hero-slide" data-index="1">
          <img src="IMG_3541.png" alt="Cleaning crew wiping down stainless steel surfaces" />
        </div>
        <div class="hero-slide" data-index="2">
          <img src="IMG_1629.png" alt="Freshly cleaned office lobby with seating area" />
        </div>
        <div class="hero-slide" data-index="3">
          <img src="IMG_1487.png" alt="Sanitized kitchen counter shining under lights" />
        </div>
        <div class="hero-dots" role="tablist" aria-label="Hero image navigation">
          <button type="button" class="hero-dot active" aria-label="Cleanup transformation image" role="tab"></button>
          <button type="button" class="hero-dot" aria-label="Cleaning crew wiping down stainless steel surfaces" role="tab"></button>
          <button type="button" class="hero-dot" aria-label="Freshly cleaned office lobby with seating area" role="tab"></button>
          <button type="button" class="hero-dot" aria-label="Sanitized kitchen counter shining under lights" role="tab"></button>
        </div>
      </div>
    </div>
  </section>

  <!-- SERVICES -->
  <section id="services" class="services-page">
    <div class="services-header">
      <h1>our services</h1>
      <p>Professional cleaning solutions tailored to your needs. From warehouses to offices, we deliver exceptional results every time.</p>
    </div>

    <div class="services-grid">
      <a class="service-card" href="book.html?pkg=industrial&service=Industrial%20%26%20Warehouse%20Deep%20Clean#start">
        <img src="img/warehouse-deep-clean.jpg" alt="Warehouse deep cleaning with floor scrubber and high-dusting" class="service-image" />
        <h3>industrial &amp; warehouse deep clean</h3>
        <p>Heavy-duty cleaning for aisles, docks, and production floors‚Äîdegreasing, machine wipe-downs, and high-dusting of beams &amp; racking.</p>
        <span class="service-cta">book this</span>
      </a>

      <a class="service-card" href="book.html?pkg=office&service=Office%20Deep%20Clean#start">
        <img src="img/office-deep-clean.jpg" alt="Office deep clean: tidy desks, mopped floors, stocked restrooms" class="service-image" />
        <h3>office deep clean</h3>
        <p>Workstations, meeting rooms, and common areas‚Äîvacuum &amp; mop, bin service &amp; recycling, restroom sanitization and supply refill.</p>
        <span class="service-cta">book this</span>
      </a>

      <a class="service-card" href="book.html?pkg=specialty&service=High-Reach%20Window%20%26%20Rail%20Cleaning%20(Scissor%20Lift)%20%E2%80%94%20Warehouses#start">
        <img src="img/highreach-warehouse.jpg" alt="Scissor-lift crew cleaning warehouse high windows and rails" class="service-image" />
        <h3>high-reach window &amp; rail (warehouses)</h3>
        <p>Clear glass and safe rails at height‚Äîperformed with scissor lifts (no rope-access). Frames, tracks, and mezzanine rails detailed and sanitized.</p>
        <span class="service-cta">book this</span>
      </a>
    </div>
  </section>

  <!-- ABOUT (restored) -->
  <section id="about" class="about-section">
    <div class="about-inner">
      <div class="about-content">
        <p class="about-intro">A quick reminder of who we are</p>
        <h2 class="about-title">
          <span class="about-script">about us</span>
        </h2>
        <p class="about-slogan">We scrub with heart so your team can focus on what matters.</p>
        <p class="about-description">
          <span>Family-built, people-first cleaning crews who respect every facility we enter.</span>
          <span>We show up on time, finish the tough jobs, and leave every surface ready to shine.</span>
          <span>Trusted by Homeowners, Offices and warehouses across Ontario. Get a free, no-obligation quote within one business day.</span>
        </p>
      </div>
      <div class="about-soap" aria-hidden="true">üßº</div>
    </div>
  </section>

  <!-- Quote logic -->
  <script>
    (function(){
      const form = document.getElementById('instant-quote');
      if(!form) return;

      const requiredFields = Array.from(form.querySelectorAll('[data-required]'));
      const basePriceEl = document.getElementById('quote-base-price');
      const totalPriceEl = document.getElementById('quote-total-price');
      const serviceSelect = document.getElementById('quote-service');
      const sqftSelect = document.getElementById('quote-square-footage');
      const serviceDetailsWrapper = document.getElementById('service-details');
      const detailGroups = serviceDetailsWrapper ? Array.from(serviceDetailsWrapper.querySelectorAll('[data-service-detail]')) : [];
      const detailSummaryRow = document.getElementById('quote-detail-row');
      const detailSummaryEl = document.getElementById('quote-detail-price');
      const choiceButtons = Array.from(form.querySelectorAll('.choice-button'));
      const seePriceBtn = document.getElementById('quote-see-price');

      const basePricing = {
        home: {
          '1000-1500': 165,
          '1500-2000': 185,
          '2000-2500': 215,
          '2500-3000': 245,
          '3000-3500': 285,
          '3500-4000': 325
        },
        commercial: {
          '1000-1500': 240,
          '1500-2000': 285,
          '2000-2500': 330,
          '2500-3000': 380,
          '3000-3500': 425,
          '3500-4000': 470
        },
        office: {
          '1000-1500': 210,
          '1500-2000': 250,
          '2000-2500': 295,
          '2500-3000': 335,
          '3000-3500': 375,
          '3500-4000': 420
        }
      };

      const detailPricing = {
        home: {
          rooms: {
            '1-2': 0,
            '3-4': 25,
            '5-6': 55,
            '7+': 85
          },
          bathrooms: {
            '1': 0,
            '2': 18,
            '3': 36,
            '4+': 54
          },
          pets: {
            no: 0,
            yes: 25
          }
        },
        office: {
          offices: {
            '1-5': 0,
            '6-10': 45,
            '11-20': 90,
            '21+': 135
          },
          bathrooms: {
            '1-2': 0,
            '3-4': 40,
            '5+': 70
          }
        }
      };

      function fieldIsRelevant(field){
        const serviceRequirement = field.dataset.serviceRequired;
        if(!serviceRequirement) return true;
        const serviceKey = serviceSelect.value;
        if(!serviceKey) return false;
        return serviceRequirement.split(',').includes(serviceKey);
      }

      function hasAllRequired(){
        return requiredFields.every(field => {
          if(!fieldIsRelevant(field)) return true;
          if(field.type === 'email'){
            return field.value.trim() !== '' && field.value.includes('@');
          }
          if(field.tagName === 'SELECT'){
            return field.value.trim() !== '';
          }
          return field.value.trim() !== '';
        });
      }

      function resetServiceGroup(group){
        const inputs = Array.from(group.querySelectorAll('[data-service-required]'));
        inputs.forEach(input => {
          if(input.tagName === 'SELECT'){
            input.selectedIndex = 0;
          } else {
            input.value = '';
          }
        });

        const buttons = Array.from(group.querySelectorAll('.choice-button'));
        buttons.forEach(btn => {
          btn.classList.remove('active');
          btn.setAttribute('aria-pressed', 'false');
        });
      }

      function updateServiceDetails(serviceKey){
        if(!serviceDetailsWrapper) return;
        let activeCount = 0;
        detailGroups.forEach(group => {
          const services = group.dataset.serviceDetail.split(',');
          const match = serviceKey && services.includes(serviceKey);
          group.classList.toggle('active', !!match);
          group.setAttribute('aria-hidden', match ? 'false' : 'true');
          if(match){
            activeCount += 1;
          } else {
            resetServiceGroup(group);
          }
        });
        serviceDetailsWrapper.classList.toggle('visible', activeCount > 0);
        serviceDetailsWrapper.setAttribute('aria-hidden', activeCount > 0 ? 'false' : 'true');
      }

      function calculateTotals(){
        const serviceKey = serviceSelect.value;
        const sqftKey = sqftSelect.value;
        if(!serviceKey || !sqftKey || !basePricing[serviceKey]){
          return { ready: false, base: 0, detail: 0, total: 0, selections: {} };
        }

        const base = basePricing[serviceKey][sqftKey] || 0;
        let detailAdjustment = 0;
        const selections = {};

        if(serviceKey === 'home'){
          const roomsField = document.getElementById('home-rooms');
          const bathField = document.getElementById('home-bathrooms');
          const petsField = document.getElementById('home-pets');

          if(roomsField && roomsField.value){
            detailAdjustment += detailPricing.home.rooms[roomsField.value] || 0;
            selections.homeRooms = {
              value: roomsField.value,
              label: roomsField.selectedOptions[0] ? roomsField.selectedOptions[0].text : roomsField.value
            };
          }
          if(bathField && bathField.value){
            detailAdjustment += detailPricing.home.bathrooms[bathField.value] || 0;
            selections.homeBathrooms = {
              value: bathField.value,
              label: bathField.selectedOptions[0] ? bathField.selectedOptions[0].text : bathField.value
            };
          }
          if(petsField && petsField.value){
            detailAdjustment += detailPricing.home.pets[petsField.value] || 0;
            selections.homePets = {
              value: petsField.value,
              label: petsField.value === 'yes' ? 'Yes' : 'No'
            };
          }
        }

        if(serviceKey === 'office'){
          const officeField = document.getElementById('office-offices');
          const officeBathField = document.getElementById('office-bathrooms');

          if(officeField && officeField.value){
            detailAdjustment += detailPricing.office.offices[officeField.value] || 0;
            selections.officeOffices = {
              value: officeField.value,
              label: officeField.selectedOptions[0] ? officeField.selectedOptions[0].text : officeField.value
            };
          }
          if(officeBathField && officeBathField.value){
            detailAdjustment += detailPricing.office.bathrooms[officeBathField.value] || 0;
            selections.officeBathrooms = {
              value: officeBathField.value,
              label: officeBathField.selectedOptions[0] ? officeBathField.selectedOptions[0].text : officeBathField.value
            };
          }
        }

        return {
          ready: true,
          base,
          detail: detailAdjustment,
          total: base + detailAdjustment,
          selections
        };
      }

      function updateTotals(){
        const totals = calculateTotals();

        if(!totals.ready){
          basePriceEl.textContent = '‚Äî';
          totalPriceEl.textContent = '‚Äî';
          if(detailSummaryRow && detailSummaryEl){
            detailSummaryRow.hidden = true;
            detailSummaryEl.textContent = '‚Äî';
          }
        } else {
          basePriceEl.textContent = `$${totals.base.toFixed(0)}`;
          totalPriceEl.textContent = `$${totals.total.toFixed(0)}`;
          if(detailSummaryRow && detailSummaryEl){
            if(totals.detail > 0){
              detailSummaryRow.hidden = false;
              detailSummaryEl.textContent = `$${totals.detail.toFixed(0)}`;
            } else {
              detailSummaryRow.hidden = true;
              detailSummaryEl.textContent = '‚Äî';
            }
          }
        }

        const ready = hasAllRequired() && totals.ready;
        form.classList.toggle('quote-ready', ready);
        if(seePriceBtn){
          seePriceBtn.disabled = !ready;
        }

        return totals;
      }

      choiceButtons.forEach(button => {
        const targetId = button.dataset.target;
        const hiddenInput = targetId ? document.getElementById(targetId) : null;
        if(!hiddenInput) return;
        button.setAttribute('aria-pressed', 'false');
        button.addEventListener('click', () => {
          const group = button.closest('.choice-buttons');
          if(group){
            const buttons = Array.from(group.querySelectorAll('.choice-button'));
            buttons.forEach(btn => {
              const isActive = btn === button;
              btn.classList.toggle('active', isActive);
              btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');
            });
          }
          hiddenInput.value = button.dataset.value || '';
          updateTotals();
        });
      });

      requiredFields.forEach(field => {
        const eventName = field.tagName === 'SELECT' ? 'change' : 'input';
        field.addEventListener(eventName, updateTotals);
      });

      serviceSelect.addEventListener('change', () => {
        updateServiceDetails(serviceSelect.value);
        updateTotals();
      });

      sqftSelect.addEventListener('change', () => {
        updateTotals();
      });

      if(seePriceBtn){
        seePriceBtn.addEventListener('click', () => {
          if(seePriceBtn.disabled) return;
          const totals = updateTotals();
          if(!totals.ready) return;

          const url = new URL('book.html', window.location.origin);
          const params = url.searchParams;

          const serviceOption = serviceSelect.selectedOptions[0];
          const sqftOption = sqftSelect.selectedOptions[0];

          params.set('service', serviceSelect.value);
          if(serviceOption){ params.set('serviceLabel', serviceOption.text); }

          params.set('sqft', sqftSelect.value);
          if(sqftOption){ params.set('sqftLabel', sqftOption.text); }

          params.set('basePrice', totals.base.toFixed(2));
          params.set('detailPrice', totals.detail.toFixed(2));
          params.set('total', totals.total.toFixed(2));

          const firstName = document.getElementById('quote-first-name');
          if(firstName && firstName.value.trim()){
            params.set('firstName', firstName.value.trim());
          }

          const email = document.getElementById('quote-email');
          if(email && email.value.trim()){
            params.set('email', email.value.trim());
          }

          Object.entries(totals.selections || {}).forEach(([key, info]) => {
            if(info.value){ params.set(key, info.value); }
            if(info.label){ params.set(`${key}Label`, info.label); }
          });

          window.location.href = `${url.toString()}#start`;
        });
      }

      updateServiceDetails(serviceSelect.value);
      updateTotals();
    })();
  </script>

  <!-- iOS detector -->
  <script>
    (function () {
      var iOS =
        /iP(hone|od|ad)/.test(navigator.platform) ||
        (navigator.userAgent.includes('Mac') && navigator.maxTouchPoints > 1);
      if (iOS) document.documentElement.classList.add('ios');
    })();
  </script>

  <!-- Hero image carousel -->
  <script>
    (function(){
      const carousel = document.getElementById('hero-carousel');
      if(!carousel) return;

      const slides = Array.from(carousel.querySelectorAll('.hero-slide'));
      const dots = Array.from(carousel.querySelectorAll('.hero-dot'));
      let index = 0;
      let timer = null;

      function setActive(next){
        slides[index].classList.remove('active');
        slides[index].setAttribute('aria-hidden', 'true');
        dots[index].classList.remove('active');
        dots[index].setAttribute('aria-selected', 'false');

        index = (next + slides.length) % slides.length;

        slides[index].classList.add('active');
        slides[index].setAttribute('aria-hidden', 'false');
        dots[index].classList.add('active');
        dots[index].setAttribute('aria-selected', 'true');
      }

      function next(){ setActive(index + 1); }

      function start(){ stop(); timer = setInterval(next, 5000); }
      function stop(){ if(timer){ clearInterval(timer); timer = null; } }

      dots.forEach((dot, i)=>{
        dot.addEventListener('click', ()=>{ setActive(i); start(); });
        dot.addEventListener('keydown', (evt)=>{
          if(evt.key === 'Enter' || evt.key === ' '){ evt.preventDefault(); setActive(i); start(); }
        });
      });

      carousel.addEventListener('mouseenter', stop);
      carousel.addEventListener('mouseleave', start);
      carousel.addEventListener('touchstart', stop, {passive:true});
      carousel.addEventListener('touchend', ()=>{ start(); }, {passive:true});

      slides.forEach((slide, i)=> slide.setAttribute('aria-hidden', i === index ? 'false' : 'true'));
      dots.forEach((dot, i)=> dot.setAttribute('aria-selected', i === index ? 'true' : 'false'));
      setActive(0);
      start();
    })();
  </script>

  <!-- Rotator logic (slide + bump + swipe) -->
  <script>
    (function(){
      const box = document.getElementById('service-rotator');
      if(!box) return;

      const slides = Array.from(box.querySelectorAll('.rotator-line'));
      const dots   = Array.from(box.querySelectorAll('.rotator-dots .dot'));
      const underline = box.querySelector('.rotator-underline');
      let idx = 0, timer = null, touchStartX = 0;

      function show(n, bump=true){
        // remove current
        slides[idx].classList.remove('active');
        dots[idx].classList.remove('active');

        // set new
        idx = (n + slides.length) % slides.length;
        slides[idx].classList.add('active');
        dots[idx].classList.add('active');

        // restart underline anim
        underline.style.animation = 'none';
        requestAnimationFrame(()=>{ underline.style.animation = ''; });

        // nudge the whole box so it feels like it moved
        if(bump){ box.classList.remove('bump'); void box.offsetWidth; box.classList.add('bump'); }
      }

      function next(){ show(idx+1); }
      function start(){ stop(); timer = setInterval(next, 4200); }
      function stop(){ if(timer){ clearInterval(timer); timer=null; } }

      // dots
      dots.forEach((d,i)=> d.addEventListener('click', ()=>{ show(i); start(); }));

      // swipe
      box.addEventListener('touchstart', e=>{ touchStartX = e.touches[0].clientX; }, {passive:true});
      box.addEventListener('touchend', e=>{
        const dx = e.changedTouches[0].clientX - touchStartX;
        if(Math.abs(dx) > 40){ show(idx + (dx<0 ? 1 : -1)); start(); }
      }, {passive:true});

      // hover pause (desktop)
      box.addEventListener('mouseenter', stop);
      box.addEventListener('mouseleave', start);

      // init
      slides.forEach((s,i)=> s.style.zIndex = String(10 - i));
      show(0,false); start();
    })();
  </script>
</body>
</html>
