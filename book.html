<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Book Online — DufferinDeepClean</title>

  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;800&family=Great+Vibes&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />

  <style>
    :root{
      --bg-tile: url('backgroundbook.png');
      --tile-w: 1536px;
      --tile-h: 1024px;
      --tile-scale: 0.90;
      --tile-w-size: calc(var(--tile-w) * var(--tile-scale));
      --tile-h-size: calc(var(--tile-h) * var(--tile-scale));
      --overlay-a: rgba(0,0,0,0.52);
      --overlay-b: rgba(0,0,0,0.78);
      --overlay-c: rgba(0,0,0,0.90);
    }

    html, body { min-height: 100%; background:#000; }
    body {
      color: #f2f5f8;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: transparent !important;
    }

    body::after{
      content:"";
      position: fixed; inset: 0; z-index: 0; pointer-events: none;
      background-image: var(--bg-tile);
      background-repeat: repeat;
      background-size: var(--tile-w-size) var(--tile-h-size);
      background-position: 0 0;
      animation: bgInfinite 56s linear infinite;
    }
    @keyframes bgInfinite {
      from { background-position: 0 0; }
      to   { background-position: var(--tile-w-size) var(--tile-h-size); }
    }

    body::before{
      content:"";
      position: fixed; inset: 0; z-index: 1; pointer-events: none;
      background: radial-gradient(1200px 600px at 50% -10%, var(--overlay-a), var(--overlay-b) 60%, var(--overlay-c));
    }

    .navbar, main, section, footer { position: relative; z-index: 2; }

    .navbar{
      display:flex; justify-content:space-between; align-items:center;
      padding: 14px 22px;
      background: rgba(0,0,0,0.20);
      backdrop-filter: blur(6px);
      border-bottom: 1px solid rgba(255,255,255,0.08);
      position: sticky; top: 0; z-index: 1000;
    }
    .logo{ display:flex; align-items:center; gap:.55rem; }
    .logo .soap{ font-size: 2.2rem; transform: translateY(2px); }
    .logo .logo-text{
      font-family: 'Great Vibes', cursive !important;
      font-size: 2.8rem; line-height: 1; letter-spacing: .4px; color:#fff;
      position:relative; display:inline-block;
      clip-path: inset(0 100% 0 0); opacity:0;
      animation: logoUnveil 1.1s ease forwards .25s;
      text-decoration: none;
    }
    @keyframes logoUnveil{0%{clip-path:inset(0 100% 0 0);opacity:0}40%{opacity:1}100%{clip-path:inset(0 0 0 0);opacity:1}}
    @keyframes logoSweep{0%{opacity:1;transform:translateX(-105%)}60%{opacity:.75}100%{opacity:0;transform:translateX(120%)}}
    .logo .logo-text::after{
      content:""; position:absolute; inset:0;
      background: linear-gradient(90deg, rgba(0,212,255,.85), rgba(255,255,255,.95));
      mix-blend-mode: screen; opacity:0; pointer-events:none;
      animation: logoSweep 1.1s ease forwards .25s;
    }

    .nav-links a{
      font-family: 'Bebas Neue', sans-serif;
      letter-spacing: .5px;
      color: #cfe0ee; text-decoration:none; margin-left:18px;
      transition: color .25s ease;
    }
    .nav-links a:hover{ color:#fff; }

    .booking{
      max-width: 1100px; margin: 0 auto;
      padding: clamp(20px, 4vw, 48px);
    }
    .booking-title{
      font-family: "Bebas Neue", system-ui, sans-serif;
      font-size: clamp(36px, 6vw, 72px);
      letter-spacing: 1px;
      margin: 10px 0 18px;
      text-transform: lowercase;
    }

    .stepper-wrap{ width: 100%; display:flex; justify-content:center; }
    .stepper{
      list-style: none; padding: 10px; margin: 0;
      width: min(100%, 1050px);
      display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px;
      background: rgba(0, 0, 0, 0.55);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      backdrop-filter: blur(6px);
      text-transform: lowercase;
    }
    .stepper li{
      padding: 14px 12px; text-align: center; border-radius: 12px;
      font-weight: 600; color: #b6c2cf;
      border: 1px dashed rgba(255,255,255,0.12);
      transition: transform .2s ease, background .2s ease, color .2s ease, border-color .2s ease;
    }
    .stepper li.done{
      color: #0f0;
      border-color: rgba(0, 208, 132, 0.35);
      background: linear-gradient(180deg, rgba(0,208,132,0.12), rgba(0,208,132,0.05));
    }
    .stepper li.active{
      color: #fff;
      background: linear-gradient(180deg, #ff90dc, #ff4fc3);
      border-color: rgba(255, 128, 210, 0.7);
      box-shadow: 0 12px 28px rgba(255, 110, 205, 0.25);
      transform: translateY(-1px);
    }

    .booking-card{
      margin: 18px auto 0; width: min(100%, 1050px);
      background: rgba(10, 12, 16, 0.72);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 20px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.45);
      backdrop-filter: blur(8px);
      overflow: hidden;
    }
    .booking-layout{
      display: grid;
      gap: clamp(18px, 3vw, 32px);
      padding: clamp(18px, 3vw, 32px);
    }
    @media (min-width: 960px){
      .booking-layout{
        grid-template-columns: minmax(260px, 320px) 1fr;
        align-items: flex-start;
      }
    }
    .booking-form{
      padding: 0;
      display: grid;
      gap: clamp(18px, 3vw, 28px);
    }
    .booking-success{ padding: clamp(16px, 3vw, 28px); }

    fieldset{ border: none; margin: 0; padding: 0; }
    legend{ font-weight: 800; font-size: 1.2rem; margin-bottom: 14px; }
    .muted{ color: #b6c2cf; }

    .booking-summary-panel{
      background: linear-gradient(180deg, rgba(12, 42, 30, 0.85), rgba(8, 30, 24, 0.7));
      border: 1px solid rgba(64, 255, 180, 0.45);
      border-radius: 22px;
      box-shadow: 0 24px 50px rgba(0,0,0,0.4);
      padding: clamp(16px, 2.4vw, 24px);
      display: flex;
      flex-direction: column;
      gap: clamp(14px, 2vw, 18px);
    }
    .booking-summary-title{
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(1.8rem, 3vw, 2.2rem);
      letter-spacing: 0.16em;
      text-transform: lowercase;
      margin: 0;
    }
    .summary-note{
      margin: 0;
      font-size: 0.9rem;
      color: rgba(207, 224, 238, 0.78);
    }
    .summary-details{
      list-style: none;
      margin: 0;
      padding: 0;
      display: grid;
      gap: 0.45rem;
      font-size: 0.9rem;
      color: rgba(214, 238, 255, 0.85);
    }
    .summary-details li{
      position: relative;
      padding-left: 1.1rem;
      line-height: 1.5;
    }
    .summary-details li::before{
      content: '';
      position: absolute;
      left: 0;
      top: 0.55rem;
      width: 0.45rem;
      height: 0.45rem;
      border-radius: 50%;
      background: rgba(64, 255, 180, 0.65);
      box-shadow: 0 0 6px rgba(64, 255, 180, 0.5);
    }
    .summary-details strong{ color: #f7fdff; font-weight: 700; }
    .summary-placeholder{
      color: rgba(207, 224, 238, 0.6);
      font-style: italic;
    }
    .summary-placeholder::before{
      background: rgba(207, 224, 238, 0.45);
      box-shadow: none;
    }
    .booking-summary-panel .quote-summary{ 
      opacity: 1;
      background: rgba(10, 32, 24, 0.72);
      border: 1px solid rgba(64, 255, 180, 0.35);
      box-shadow: inset 0 0 18px rgba(64, 255, 180, 0.12);
    }
    .booking-summary-panel .quote-summary-line strong{
      text-shadow: 0 0 12px rgba(64, 255, 180, 0.35);
      color: #eafff5;
    }
    .booking-summary-panel .quote-summary-line.total strong{
      color: #b8ffe6;
    }

    .grid-2{ display: grid; gap: 14px; grid-template-columns: 1fr; }
    .grid-2 .wide{ grid-column: 1 / -1; }
    @media (min-width: 720px){ .grid-2{ grid-template-columns: 1fr 1fr; } }

    label{ display:flex; flex-direction:column; gap:6px; font-size: .95rem; }
    input, select, textarea{
      border-radius: 12px; border: 1px solid rgba(255,255,255,0.08); padding: 12px 12px;
      background: rgba(255,255,255,0.05); color: #f2f5f8; outline: none;
    }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(76,195,255,0.7);
      box-shadow: 0 0 0 3px rgba(76,195,255,0.25);
      background: rgba(255,255,255,0.08);
    }

    .plans{ display:grid; gap:12px; grid-template-columns: 1fr; }
    @media (min-width: 840px){ .plans{ grid-template-columns: repeat(3, 1fr); } }
    .plan{ display:block; }
    .plan input{ display:none; }
    .plan-card{
      border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; padding: 14px;
      background: rgba(255,255,255,0.04);
      transition: transform .2s ease, border-color .2s ease, background .2s ease;
    }
    .plan input:checked + .plan-card{
      border-color: rgba(0,208,132,0.6);
      background: linear-gradient(180deg, rgba(0,208,132,0.12), rgba(0,208,132,0.05));
      transform: translateY(-1px);
    }
    .plan-title{ font-weight: 800; }
    .plan-discount{ color: #00d084; font-weight: 700; }
    .plan-note{ color: #b6c2cf; font-size: .9rem; }

    .actions{ margin-top: 18px; display:flex; gap:10px; justify-content:flex-end; flex-wrap: wrap; }
    .btn{
      appearance: none; border: 1px solid rgba(255,255,255,0.08); color: #0b0d10;
      background: linear-gradient(180deg, #4cc3ff, #00e0a4);
      font-weight: 800; border-radius: 12px; padding: 10px 16px; cursor: pointer;
    }
    .btn.back{
      background: rgba(255,255,255,0.06); color: #f2f5f8;
    }
    .btn:hover{ filter: brightness(1.05); }

    .review{
      display:grid; gap:10px;
      border: 1px solid rgba(255,255,255,0.08);
      background: rgba(255,255,255,0.04);
      border-radius: 12px;
      padding: 14px;
    }
    .review dt{ font-weight: 700; color: #b6c2cf; }
    .review dd{ margin: 0 0 10px; }

    .addon-empty{ color: rgba(214, 238, 255, 0.7); font-size: 0.95rem; }

    .payment-wall{
      display: grid;
      gap: clamp(16px, 3vw, 24px);
      padding: clamp(18px, 3vw, 26px);
      border-radius: 18px;
      border: 1px solid rgba(0,212,255,0.18);
      background: linear-gradient(160deg, rgba(6, 24, 36, 0.85), rgba(4, 16, 28, 0.65));
      box-shadow: 0 24px 60px rgba(0,0,0,0.45);
    }
    @media (min-width: 960px){
      .payment-wall{
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
        align-items: start;
      }
      .payment-wall .payment-guides,
      .payment-wall .review{
        grid-column: 1 / -1;
      }
    }
    .payment-overview{
      display: grid;
      gap: clamp(14px, 3vw, 20px);
      background: rgba(4, 18, 28, 0.6);
      border: 1px solid rgba(0,212,255,0.16);
      border-radius: 16px;
      padding: clamp(14px, 2.5vw, 20px);
    }
    @media (min-width: 720px){
      .payment-overview{
        grid-template-columns: minmax(0, 2fr) minmax(0, 1fr);
        align-items: flex-start;
      }
    }
    .payment-policy h3{
      margin: 0 0 0.5rem;
      font-size: 1.1rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #eaf9ff;
    }
    .payment-policy p{
      margin: 0;
      color: rgba(214, 238, 255, 0.8);
      font-size: 0.95rem;
      line-height: 1.6;
    }
    .payment-breakdown{
      display: grid;
      gap: 0.4rem;
      color: rgba(214, 238, 255, 0.86);
      font-size: 0.95rem;
    }
    .payment-breakdown .label{ color: rgba(214, 238, 255, 0.7); text-transform: uppercase; letter-spacing: 0.08em; font-size: 0.75rem; margin-right: 0.35rem; }
    .payment-breakdown strong{ font-size: 1.05rem; color: #f7fffe; }
    .payment-deposit-note{ margin: 0; font-size: 0.85rem; color: rgba(214, 238, 255, 0.7); }

    .payment-methods{
      border: 1px solid rgba(0,212,255,0.14);
      border-radius: 16px;
      padding: clamp(14px, 2.5vw, 20px);
      background: rgba(2, 12, 20, 0.55);
    }
    .payment-methods .sublegend{
      font-size: 0.95rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      margin-bottom: 0.75rem;
      color: rgba(214, 238, 255, 0.78);
    }
    .payment-option{
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 0.75rem;
      align-items: start;
      padding: 0.65rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .payment-option:last-of-type{ border-bottom: none; }
    .payment-option input{ margin-top: 0.35rem; }
    .payment-option-card{
      display: grid;
      gap: 0.35rem;
      background: linear-gradient(150deg, rgba(0, 44, 66, 0.55), rgba(0, 18, 30, 0.65));
      border: 1px solid rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 0.65rem 0.8rem;
      transition: border-color .2s ease, box-shadow .2s ease;
    }
    .payment-option input:checked + .payment-option-card{
      border-color: rgba(0,212,255,0.5);
      box-shadow: 0 18px 32px rgba(0,0,0,0.4);
    }
    .payment-option-title{ font-weight: 700; color: #f5fbff; }
    .payment-option-note{ color: rgba(214, 238, 255, 0.75); font-size: 0.9rem; line-height: 1.5; }
    .payment-option-note a{ color: #7ce9ff; }

    .payment-guides{
      border: 1px dashed rgba(0,212,255,0.22);
      border-radius: 16px;
      padding: clamp(12px, 2vw, 18px);
      background: rgba(4, 18, 28, 0.45);
      display: grid;
      gap: 0.6rem;
    }
    .payment-guides h3{
      margin: 0;
      font-size: 1rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: #e6f8ff;
    }
    .payment-guides p{ margin: 0; color: rgba(214, 238, 255, 0.72); font-size: 0.88rem; }
    .payment-guides-list{
      list-style: none;
      margin: 0;
      padding: 0;
      display: grid;
      gap: 0.45rem;
    }
    .payment-guides-list li{
      font-size: 0.88rem;
      color: rgba(214, 238, 255, 0.78);
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      align-items: baseline;
    }
    .payment-guides-list a{ color: #7ce9ff; }

    .payment-wall .review{
      background: rgba(2, 12, 20, 0.55);
      border-color: rgba(0,212,255,0.14);
      padding: clamp(12px, 2.5vw, 18px);
    }
    .payment-wall .review dt{ color: rgba(173, 214, 255, 0.78); }
    .payment-wall .review dd{ color: #f2f5f8; }
  </style>
</head>
<body>
  <header class="navbar">
    <div class="logo">
      <span class="soap">🧼</span>
      <a class="logo-text" href="index.html">DufferinDeepClean</a>
    </div>
    <nav class="nav-links">
      <a href="index.html#home">Home</a>
      <a href="index.html#services">Services</a>
      <a href="about.html">About Us</a>
    </nav>
  </header>

  <section class="booking" id="start">
    <h1 class="booking-title">book online</h1>

    <div class="stepper-wrap">
      <ol class="stepper" id="stepper">
        <li class="active">1. price summary</li>
        <li>2. add extras</li>
        <li>3. when &amp; where</li>
        <li>4. your details</li>
        <li>5. review &amp; confirm</li>
      </ol>
    </div>

    <div class="booking-card">
      <div class="booking-layout" id="bookingLayout">
        <aside class="booking-summary-panel" aria-labelledby="booking-summary-title">
          <h2 id="booking-summary-title" class="booking-summary-title">price summary</h2>
          <p class="summary-note" id="summary-frequency-note">Start with an instant quote to unlock pricing.</p>
          <div class="quote-summary" id="booking-summary" aria-live="polite">
            <div class="quote-summary-line">
              <span>Base Package</span>
              <strong id="summary-base-price">—</strong>
            </div>
            <div class="quote-summary-line" id="summary-detail-row" hidden>
              <span>Service Details</span>
              <strong id="summary-detail-price">—</strong>
            </div>
            <div class="quote-summary-line" id="summary-extras-row" hidden>
              <span>Add-ons</span>
              <strong id="summary-extras-price">—</strong>
            </div>
            <div class="quote-summary-line" id="summary-discount-row" hidden>
              <span>Frequency Savings</span>
              <strong id="summary-discount-price">—</strong>
            </div>
            <div class="quote-summary-line" id="summary-deposit-row" hidden>
              <span>Deposit Due Today (50%)</span>
              <strong id="summary-deposit-price">—</strong>
            </div>
            <div class="quote-summary-line" id="summary-balance-row" hidden>
              <span>Balance at Service</span>
              <strong id="summary-balance-price">—</strong>
            </div>
            <div class="quote-summary-line total">
              <span>Estimated Visit Total</span>
              <strong id="summary-total-price">—</strong>
            </div>
          </div>
          <ul class="summary-details" id="summary-detail-list">
            <li class="summary-placeholder">Your base package selections will appear here once you start an instant quote.</li>
          </ul>
        </aside>

        <form id="bookingForm" class="booking-form" action="https://formspree.io/f/mrblyqpr" method="POST">

          <input type="hidden" name="service_key" id="input-service-key">
          <input type="hidden" name="service_label" id="input-service-label">
          <input type="hidden" name="square_footage_range" id="input-sqft-label">
          <input type="hidden" name="detail_summary" id="input-detail-summary">
          <input type="hidden" name="base_package_price" id="input-base-price">
          <input type="hidden" name="service_detail_price" id="input-detail-price">
          <input type="hidden" name="addons_price" id="input-addons-price">
          <input type="hidden" name="frequency_savings" id="input-discount-price">
          <input type="hidden" name="deposit_due" id="input-deposit-price">
          <input type="hidden" name="balance_due" id="input-balance-price">
          <input type="hidden" name="final_visit_total" id="input-total-price">
          <input type="hidden" name="selected_addons" id="input-selected-addons">
          <input type="hidden" name="origin_quote" id="input-origin" value="">
          <input type="hidden" name="package" id="input-package">

          <fieldset class="step" data-step="1">
          <legend>Your base package</legend>
          <p class="muted">Review the base price we created from your instant quote and choose how often you'd like us to clean.</p>
          <div class="plans">
            <label class="plan">
              <input type="radio" name="frequency" value="weekly" data-discount="0.25" required />
              <div class="plan-card">
                <div class="plan-title">Weekly</div>
                <div class="plan-discount">25% off</div>
                <div class="plan-note">Best value &amp; consistency</div>
              </div>
            </label>
            <label class="plan">
              <input type="radio" name="frequency" value="biweekly" data-discount="0.20" />
              <div class="plan-card">
                <div class="plan-title">Bi-Weekly</div>
                <div class="plan-discount">20% off</div>
                <div class="plan-note">Great for busy offices</div>
              </div>
            </label>
            <label class="plan">
              <input type="radio" name="frequency" value="triweekly" data-discount="0.15" />
              <div class="plan-card">
                <div class="plan-title">Tri-Weekly</div>
                <div class="plan-discount">15% off</div>
                <div class="plan-note">Light traffic spaces</div>
              </div>
            </label>
            <label class="plan">
              <input type="radio" name="frequency" value="monthly" data-discount="0.10" />
              <div class="plan-card">
                <div class="plan-title">Monthly</div>
                <div class="plan-discount">10% off</div>
                <div class="plan-note">Deep refresh once a month</div>
              </div>
            </label>
            <label class="plan">
              <input type="radio" name="frequency" value="biannual" data-discount="0.05" />
              <div class="plan-card">
                <div class="plan-title">Biannual</div>
                <div class="plan-discount">5% off</div>
                <div class="plan-note">Seasonal top-to-bottom</div>
              </div>
            </label>
            <label class="plan">
              <input type="radio" name="frequency" value="onetime" data-discount="0" />
              <div class="plan-card">
                <div class="plan-title">One-time</div>
                <div class="plan-discount">Standard rate</div>
                <div class="plan-note">Perfect for move-ins &amp; projects</div>
              </div>
            </label>
          </div>
          <div class="actions">
            <button type="button" class="btn next">Next</button>
          </div>
        </fieldset>

        <fieldset class="step" data-step="2" hidden>
          <legend>Add extra services</legend>
          <p class="muted">Add speciality tasks for this visit. Select a tile to include it and adjust the quantity if needed.</p>
          <div class="addon-groups" id="addon-groups">
            <div class="addon-group" data-service-group="home">
              <p class="addon-group-title">Home &amp; Residential Extras</p>
              <div class="addon-pill color-cyan" data-addon="Deep Clean Package" data-price="80">
                <span class="addon-icon">✨</span>
                <span class="addon-name">Deep Clean Package</span>
                <input class="addon-qty" type="number" min="1" max="10" value="1" aria-label="Deep Clean Package quantity">
              </div>
              <div class="addon-pill color-lime" data-addon="Move In/Out Clean Package" data-price="95">
                <span class="addon-icon">🚚</span>
                <span class="addon-name">Move In/Out Clean Package</span>
                <input class="addon-qty" type="number" min="1" max="10" value="1" aria-label="Move In/Out Clean Package quantity">
              </div>
              <div class="addon-pill color-magenta" data-addon="Renovation Clean Package" data-price="110">
                <span class="addon-icon">🛠️</span>
                <span class="addon-name">Renovation Clean Package</span>
                <input class="addon-qty" type="number" min="1" max="10" value="1" aria-label="Renovation Clean Package quantity">
              </div>
              <div class="addon-pill color-orange" data-addon="Move In/Out Package (Student Property)" data-price="70">
                <span class="addon-icon">🎓</span>
                <span class="addon-name">Move In/Out Package (Student Property)</span>
                <input class="addon-qty" type="number" min="1" max="10" value="1" aria-label="Move In/Out Package (Student Property) quantity">
              </div>
              <div class="addon-pill color-indigo" data-addon="AirBnB Listing" data-price="65">
                <span class="addon-icon">🏠</span>
                <span class="addon-name">AirBnB Listing</span>
                <input class="addon-qty" type="number" min="1" max="10" value="1" aria-label="AirBnB Listing quantity">
              </div>
              <div class="addon-pill color-gold" data-addon="I have Pets" data-price="35">
                <span class="addon-icon">🐾</span>
                <span class="addon-name">I have Pets</span>
                <input class="addon-qty" type="number" min="1" max="10" value="1" aria-label="I have Pets quantity">
              </div>
              <div class="addon-pill color-sky" data-addon="Inside Fridge" data-price="25">
                <span class="addon-icon">🧊</span>
                <span class="addon-name">Inside Fridge</span>
                <input class="addon-qty" type="number" min="1" max="10" value="1" aria-label="Inside Fridge quantity">
              </div>
              <div class="addon-pill color-rose" data-addon="Inside Oven" data-price="25">
                <span class="addon-icon">🔥</span>
                <span class="addon-name">Inside Oven</span>
                <input class="addon-qty" type="number" min="1" max="10" value="1" aria-label="Inside Oven quantity">
              </div>
              <div class="addon-pill color-mint" data-addon="Inside Cabinets" data-price="30">
                <span class="addon-icon">🗄️</span>
                <span class="addon-name">Inside Cabinets</span>
                <input class="addon-qty" type="number" min="1" max="10" value="1" aria-label="Inside Cabinets quantity">
              </div>
              <div class="addon-pill color-teal" data-addon="Additional Kitchen" data-price="45">
                <span class="addon-icon">🍽️</span>
                <span class="addon-name">Additional Kitchen</span>
                <input class="addon-qty" type="number" min="1" max="10" value="1" aria-label="Additional Kitchen quantity">
              </div>
              <div class="addon-pill color-plum" data-addon="Blinds (per window)" data-price="8">
                <span class="addon-icon">🪟</span>
                <span class="addon-name">Blinds (per window)</span>
                <input class="addon-qty" type="number" min="1" max="25" value="1" aria-label="Blinds quantity">
              </div>
              <div class="addon-pill color-azure" data-addon="Inside Windows with Tracks (up to 6)" data-price="60">
                <span class="addon-icon">🔍</span>
                <span class="addon-name">Inside Windows with Tracks (up to 6)</span>
                <input class="addon-qty" type="number" min="1" max="5" value="1" aria-label="Inside Windows with Tracks up to 6 quantity">
              </div>
              <div class="addon-pill color-amber" data-addon="Inside Windows with Tracks (up to 12)" data-price="105">
                <span class="addon-icon">🔎</span>
                <span class="addon-name">Inside Windows with Tracks (up to 12)</span>
                <input class="addon-qty" type="number" min="1" max="5" value="1" aria-label="Inside Windows with Tracks up to 12 quantity">
              </div>
              <div class="addon-pill color-blue" data-addon="Inside Windows with Tracks (up to 24)" data-price="195">
                <span class="addon-icon">🪟</span>
                <span class="addon-name">Inside Windows with Tracks (up to 24)</span>
                <input class="addon-qty" type="number" min="1" max="5" value="1" aria-label="Inside Windows with Tracks up to 24 quantity">
              </div>
              <div class="addon-pill color-lavender" data-addon="Change Bed Sheets + Load Laundry" data-price="18">
                <span class="addon-icon">🛏️</span>
                <span class="addon-name">Change Bed Sheets + Load Laundry</span>
                <input class="addon-qty" type="number" min="1" max="10" value="1" aria-label="Change Bed Sheets quantity">
              </div>
              <div class="addon-pill color-crimson" data-addon="Load Dishwasher" data-price="10">
                <span class="addon-icon">🍽️</span>
                <span class="addon-name">Load Dishwasher</span>
                <input class="addon-qty" type="number" min="1" max="10" value="1" aria-label="Load Dishwasher quantity">
              </div>
              <div class="addon-pill color-emerald" data-addon="Sanitization Package" data-price="55">
                <span class="addon-icon">🧴</span>
                <span class="addon-name">Sanitization Package</span>
                <input class="addon-qty" type="number" min="1" max="10" value="1" aria-label="Sanitization Package quantity">
              </div>
            </div>

            <div class="addon-group" data-service-group="commercial,office">
              <p class="addon-group-title">Facility &amp; Workspace Enhancements</p>
              <div class="addon-pill color-indigo" data-addon="Carpet Steam Cleaning Package" data-price="140">
                <span class="addon-icon">🧼</span>
                <span class="addon-name">Carpet Steam Cleaning Package</span>
                <input class="addon-qty" type="number" min="1" max="10" value="1" aria-label="Carpet Steam Cleaning quantity">
              </div>
              <div class="addon-pill color-azure" data-addon="Tile and Grout Cleaning Package" data-price="130">
                <span class="addon-icon">🧽</span>
                <span class="addon-name">Tile and Grout Cleaning Package</span>
                <input class="addon-qty" type="number" min="1" max="10" value="1" aria-label="Tile and Grout Cleaning quantity">
              </div>
              <div class="addon-pill color-mint" data-addon="Restock Bathroom Supply" data-price="40">
                <span class="addon-icon">🧻</span>
                <span class="addon-name">Restock Bathroom Supply</span>
                <input class="addon-qty" type="number" min="1" max="10" value="1" aria-label="Restock Bathroom Supply quantity">
              </div>
              <div class="addon-pill color-gold" data-addon="Disinfect Electronics" data-price="45">
                <span class="addon-icon">💻</span>
                <span class="addon-name">Disinfect Electronics</span>
                <input class="addon-qty" type="number" min="1" max="10" value="1" aria-label="Disinfect Electronics quantity">
              </div>
              <div class="addon-pill color-teal" data-addon="Empty Garbage/Recycling" data-price="18">
                <span class="addon-icon">🗑️</span>
                <span class="addon-name">Empty Garbage/Recycling</span>
                <input class="addon-qty" type="number" min="1" max="20" value="1" aria-label="Empty Garbage/Recycling quantity">
              </div>
              <div class="addon-pill color-lime" data-addon="Water Plants" data-price="15">
                <span class="addon-icon">🌿</span>
                <span class="addon-name">Water Plants</span>
                <input class="addon-qty" type="number" min="1" max="20" value="1" aria-label="Water Plants quantity">
              </div>
            </div>
          </div>
          <p class="addon-empty" id="addon-empty-message" hidden>No add-ons available for this service. Continue to scheduling.</p>
          <div class="actions">
            <button type="button" class="btn back">Back</button>
            <button type="button" class="btn next">Next</button>
          </div>
        </fieldset>

        <fieldset class="step" data-step="3" hidden>
          <legend>When &amp; where</legend>
          <div class="grid-2">
            <label>
              Business name (optional)
              <input type="text" name="business" placeholder="ACME Distribution" />
            </label>
            <label>
              Address
              <input id="address" type="text" name="address" placeholder="123 Main St" required autocomplete="address-line1" />
            </label>
            <label>
              City
              <input id="city" type="text" name="city" placeholder="Mono" required autocomplete="address-level2" />
            </label>
            <label>
              Postal Code
              <input id="postal" type="text" name="postal" placeholder="L9W 1A1" required autocomplete="postal-code" />
            </label>
            <label>
              Preferred date
              <input type="date" name="date" required />
            </label>
            <label>
              Preferred time
              <input type="time" name="time" required />
            </label>
            <label class="wide">
              Approx. square footage
              <input type="number" name="sqft" min="100" step="50" placeholder="e.g., 5,000" />
            </label>
          </div>
          <div class="actions">
            <button type="button" class="btn back">Back</button>
            <button type="button" class="btn next">Next</button>
          </div>
        </fieldset>

        <fieldset class="step" data-step="4" hidden>
          <legend>Your contact information</legend>
          <div class="grid-2">
            <label>
              Full name
              <input type="text" name="name" placeholder="Jane Smith" required />
            </label>
            <label>
              Email
              <input type="email" name="email" placeholder="you@company.com" required />
            </label>
            <label>
              Phone
              <input type="tel" name="phone" placeholder="(555) 555-5555" required />
            </label>
            <label class="wide">
              Notes (optional)
              <textarea name="notes" rows="3" placeholder="Access details, special instructions, etc."></textarea>
            </label>
          </div>
          <div class="actions">
            <button type="button" class="btn back">Back</button>
            <button type="button" class="btn next">Next</button>
          </div>
        </fieldset>

        <fieldset class="step" data-step="5" hidden>
          <legend>Review, book &amp; pay</legend>
          <div class="payment-wall">
            <div class="payment-overview">
              <div class="payment-policy">
                <h3>Payment Policy</h3>
                <p>A 50% deposit is required at the time of booking to secure your appointment. The remaining balance is due upon completion of the service. Deposits are non-refundable if cancellations occur within 48 hours of the scheduled cleaning.</p>
              </div>
              <div class="payment-breakdown">
                <p><span class="label">Deposit Due Today:</span> <strong id="deposit-due-text">—</strong></p>
                <p><span class="label">Balance at Service:</span> <strong id="balance-due-text">—</strong></p>
              </div>
              <p class="payment-deposit-note">Your deposit total updates automatically as you add services so you always see the 50% due today.</p>
            </div>

            <fieldset class="payment-methods">
              <legend class="sublegend">Choose your payment method</legend>
              <label class="payment-option">
                <input type="radio" name="payment_method" value="paypal" required>
                <span class="payment-option-card">
                  <span class="payment-option-title">PayPal</span>
                  <span class="payment-option-note">Use your PayPal balance or linked card. <a href="https://developer.paypal.com/docs/checkout/standard/" target="_blank" rel="noopener">Integration guide</a>.</span>
                </span>
              </label>
              <label class="payment-option">
                <input type="radio" name="payment_method" value="google-pay">
                <span class="payment-option-card">
                  <span class="payment-option-title">Google Pay</span>
                  <span class="payment-option-note">Tap-to-pay convenience across devices. <a href="https://developers.google.com/pay/api/web" target="_blank" rel="noopener">Web API docs</a>.</span>
                </span>
              </label>
              <label class="payment-option">
                <input type="radio" name="payment_method" value="debit">
                <span class="payment-option-card">
                  <span class="payment-option-title">Direct Debit / Card on File</span>
                  <span class="payment-option-note">Securely store a business debit or credit card for the remaining balance. <a href="https://stripe.com/docs/payments/ach-debit" target="_blank" rel="noopener">ACH / debit setup guide</a>.</span>
                </span>
              </label>
            </fieldset>

            <div class="payment-guides">
              <h3>Connect your payment gateway</h3>
              <p>Ready to accept deposits online? Use these quick-start guides to plug in the provider of your choice.</p>
              <ul class="payment-guides-list">
                <li><strong>PayPal Checkout:</strong> <a href="https://developer.paypal.com/docs/checkout/" target="_blank" rel="noopener">developer.paypal.com/docs/checkout/</a></li>
                <li><strong>Google Pay on Web:</strong> <a href="https://developers.google.com/pay/api/web" target="_blank" rel="noopener">developers.google.com/pay/api/web</a></li>
                <li><strong>ACH / Debit via Stripe:</strong> <a href="https://stripe.com/docs/payments/ach-debit" target="_blank" rel="noopener">stripe.com/docs/payments/ach-debit</a></li>
              </ul>
            </div>

            <dl class="review" id="reviewList"></dl>
          </div>
          <div class="actions">
            <button type="button" class="btn back">Back</button>
            <button type="submit" class="btn submit">Submit</button>
          </div>
        </fieldset>
      </form>

      </div>

      <div id="bookingSuccess" class="booking-success" hidden>
        <h2>Thanks! Your request has been received.</h2>
        <p>We’ll get back to you within one business day to confirm your booking.</p>
        <a href="index.html" class="btn">Back to Home</a>
      </div>
    </div>
  </section>

  <script>
    (function () {
      var iOS = /iP(hone|od|ad)/.test(navigator.platform) || (navigator.userAgent.includes('Mac') && navigator.maxTouchPoints > 1);
      if (iOS) document.documentElement.classList.add('ios');
    })();
  </script>

  <script>
    (function(){
      const quoteForms = Array.from(document.querySelectorAll('form.quote-form'));
      if(!quoteForms.length) return;

      const basePricing = {
        home: {
          '1000-1500': 165,
          '1500-2000': 185,
          '2000-2500': 215,
          '2500-3000': 245,
          '3000-3500': 285,
          '3500-4000': 325
        },
        commercial: {
          '1000-1500': 240,
          '1500-2000': 285,
          '2000-2500': 330,
          '2500-3000': 380,
          '3000-3500': 425,
          '3500-4000': 470
        },
        office: {
          '1000-1500': 210,
          '1500-2000': 250,
          '2000-2500': 295,
          '2500-3000': 335,
          '3000-3500': 375,
          '3500-4000': 420
        }
      };

      const detailPricing = {
        home: {
          rooms: { '1-2': 0, '3-4': 25, '5-6': 55, '7+': 85 },
          bathrooms: { '1': 0, '2': 18, '3': 36, '4+': 54 },
          pets: { no: 0, yes: 25 }
        },
        office: {
          offices: { '1-5': 0, '6-10': 45, '11-20': 90, '21+': 135 },
          bathrooms: { '1-2': 0, '3-4': 40, '5+': 70 }
        }
      };

      quoteForms.forEach(setupQuoteForm);

      function setupQuoteForm(form){
        const requiredFields = Array.from(form.querySelectorAll('[data-required]'));
        const basePriceEl = form.querySelector('[data-quote-base]');
        const detailRow = form.querySelector('[data-quote-detail-row]');
        const detailPriceEl = form.querySelector('[data-quote-detail]');
        const totalPriceEl = form.querySelector('[data-quote-total]');
        const serviceInput = form.querySelector('input[name="service"]');
        const sqftInput = form.querySelector('input[name="square-footage"]');
        const serviceDetailsWrapper = form.querySelector('.service-details');
        const detailGroups = serviceDetailsWrapper ? Array.from(serviceDetailsWrapper.querySelectorAll('[data-service-detail]')) : [];
        const seePriceBtn = form.querySelector('.quote-see-price');
        const pillControls = Array.from(form.querySelectorAll('[data-target-input]'));

        function fieldIsRelevant(field){
          const requirement = field.dataset.serviceRequired;
          if(!requirement) return true;
          const serviceKey = serviceInput ? serviceInput.value : '';
          if(!serviceKey) return false;
          return requirement.split(',').includes(serviceKey);
        }

        function hasAllRequired(){
          return requiredFields.every(field => {
            if(!fieldIsRelevant(field)) return true;
            const value = field.value ? field.value.trim() : '';
            if(field.type === 'email'){
              return value !== '' && value.includes('@');
            }
            return value !== '';
          });
        }

        function resetServiceGroup(group){
          const hiddenInputs = Array.from(group.querySelectorAll('input[type="hidden"]'));
          hiddenInputs.forEach(input => {
            input.value = '';
            input.dataset.label = '';
          });
          const buttons = Array.from(group.querySelectorAll('[data-target-input]'));
          buttons.forEach(btn => {
            btn.classList.remove('active');
            btn.setAttribute('aria-pressed', 'false');
          });
        }

        function updateServiceDetails(serviceKey){
          if(!serviceDetailsWrapper) return;
          let activeCount = 0;
          detailGroups.forEach(group => {
            const services = (group.dataset.serviceDetail || '').split(',');
            const match = serviceKey && services.includes(serviceKey);
            group.classList.toggle('active', !!match);
            group.setAttribute('aria-hidden', match ? 'false' : 'true');
            if(match){
              activeCount += 1;
            } else {
              resetServiceGroup(group);
            }
          });
          serviceDetailsWrapper.classList.toggle('visible', activeCount > 0);
          serviceDetailsWrapper.setAttribute('aria-hidden', activeCount > 0 ? 'false' : 'true');
        }

        function selectionInfo(input){
          if(!input || !input.value) return null;
          return {
            value: input.value,
            label: input.dataset.label || input.value
          };
        }

        function calculateTotals(){
          const serviceKey = serviceInput ? serviceInput.value : '';
          const sqftKey = sqftInput ? sqftInput.value : '';
          if(!serviceKey || !sqftKey || !basePricing[serviceKey]){
            return { ready: false, base: 0, detail: 0, total: 0, selections: {}, serviceLabel: '', sqftLabel: '' };
          }

          const base = basePricing[serviceKey][sqftKey] || 0;
          let detailAdjustment = 0;
          const selections = {};

          if(serviceKey === 'home'){
            const roomsField = form.querySelector('input[name="home-rooms"]');
            const bathsField = form.querySelector('input[name="home-bathrooms"]');
            const petsField = form.querySelector('input[name="home-pets"]');

            const roomsInfo = selectionInfo(roomsField);
            const bathsInfo = selectionInfo(bathsField);
            const petsInfo = selectionInfo(petsField);

            if(roomsInfo){
              detailAdjustment += detailPricing.home.rooms[roomsInfo.value] || 0;
              selections.homeRooms = roomsInfo;
            }
            if(bathsInfo){
              detailAdjustment += detailPricing.home.bathrooms[bathsInfo.value] || 0;
              selections.homeBathrooms = bathsInfo;
            }
            if(petsInfo){
              detailAdjustment += detailPricing.home.pets[petsInfo.value] || 0;
              selections.homePets = petsInfo;
            }
          }

          if(serviceKey === 'office'){
            const officesField = form.querySelector('input[name="office-offices"]');
            const officeBathsField = form.querySelector('input[name="office-bathrooms"]');

            const officesInfo = selectionInfo(officesField);
            const officeBathsInfo = selectionInfo(officeBathsField);

            if(officesInfo){
              detailAdjustment += detailPricing.office.offices[officesInfo.value] || 0;
              selections.officeOffices = officesInfo;
            }
            if(officeBathsInfo){
              detailAdjustment += detailPricing.office.bathrooms[officeBathsInfo.value] || 0;
              selections.officeBathrooms = officeBathsInfo;
            }
          }

          return {
            ready: true,
            base,
            detail: detailAdjustment,
            total: base + detailAdjustment,
            selections,
            serviceLabel: serviceInput?.dataset.label || serviceKey,
            sqftLabel: sqftInput?.dataset.label || sqftKey
          };
        }

        function formatCurrency(value){
          if(!value) return '—';
          return `$${Math.round(value)}`;
        }

        function updateTotals(){
          const totals = calculateTotals();

          if(basePriceEl){ basePriceEl.textContent = totals.ready ? formatCurrency(totals.base) : '—'; }
          if(totalPriceEl){ totalPriceEl.textContent = totals.ready ? formatCurrency(totals.total) : '—'; }

          if(detailRow && detailPriceEl){
            if(totals.ready && totals.detail > 0){
              detailRow.hidden = false;
              detailPriceEl.textContent = `+$${Math.round(totals.detail)}`;
            } else {
              detailRow.hidden = true;
              detailPriceEl.textContent = '—';
            }
          }

          const ready = totals.ready && hasAllRequired();
          form.classList.toggle('quote-ready', ready);
          if(seePriceBtn){ seePriceBtn.disabled = !ready; }

          return totals;
        }

        pillControls.forEach(control => {
          const targetName = control.dataset.targetInput;
          if(!targetName) return;
          const hiddenInput = form.querySelector(`input[name="${targetName}"]`);
          if(!hiddenInput) return;

          control.setAttribute('aria-pressed', 'false');

          control.addEventListener('click', () => {
            const group = control.closest('[role="radiogroup"]') || control.parentElement;
            if(group){
              Array.from(group.querySelectorAll('[data-target-input="' + targetName + '"]')).forEach(btn => {
                const active = btn === control;
                btn.classList.toggle('active', active);
                btn.setAttribute('aria-pressed', active ? 'true' : 'false');
              });
            }

            hiddenInput.value = control.dataset.value || '';
            hiddenInput.dataset.label = control.dataset.label || hiddenInput.value;
            hiddenInput.dispatchEvent(new Event('change', { bubbles: true }));
            updateServiceDetails(serviceInput ? serviceInput.value : '');
            updateTotals();
          });
        });

        requiredFields.forEach(field => {
          const eventName = field.tagName === 'SELECT' ? 'change' : 'input';
          field.addEventListener(eventName, updateTotals);
        });

        if(serviceInput){
          serviceInput.addEventListener('change', () => {
            updateServiceDetails(serviceInput.value);
            updateTotals();
          });
        }

        if(sqftInput){
          sqftInput.addEventListener('change', updateTotals);
        }

        if(seePriceBtn){
          seePriceBtn.addEventListener('click', () => {
            if(seePriceBtn.disabled) return;
            const totals = updateTotals();
            if(!totals.ready) return;

            const mode = form.dataset.quoteMode || 'redirect';
            if(mode !== 'redirect') return;

            const redirectTarget = form.dataset.redirect || 'book.html';
            const url = new URL(redirectTarget, window.location.origin);
            const params = url.searchParams;

            const serviceValue = serviceInput ? serviceInput.value : '';
            if(serviceValue){
              params.set('service', serviceValue);
              if(totals.serviceLabel){ params.set('serviceLabel', totals.serviceLabel); }
            }

            const sqftValue = sqftInput ? sqftInput.value : '';
            if(sqftValue){
              params.set('sqft', sqftValue);
              if(totals.sqftLabel){ params.set('sqftLabel', totals.sqftLabel); }
            }

            params.set('basePrice', totals.base.toFixed(2));
            params.set('detailPrice', totals.detail.toFixed(2));
            params.set('total', totals.total.toFixed(2));

            const firstName = form.querySelector('input[name="first-name"]');
            if(firstName && firstName.value.trim()){
              params.set('firstName', firstName.value.trim());
            }

            const email = form.querySelector('input[name="email"]');
            if(email && email.value.trim()){
              params.set('email', email.value.trim());
            }

            Object.entries(totals.selections || {}).forEach(([key, info]) => {
              if(info.value){ params.set(key, info.value); }
              if(info.label){ params.set(`${key}Label`, info.label); }
            });

            const anchor = form.dataset.redirectAnchor;
            const finalUrl = anchor ? `${url.toString()}#${anchor}` : url.toString();
            window.location.href = finalUrl;
          });
        }

        updateServiceDetails(serviceInput ? serviceInput.value : '');
        updateTotals();
      }
    })();
  </script>

  <script>
    (function(){
      const form = document.getElementById('bookingForm');
      if(!form) return;

      const steps = Array.from(form.querySelectorAll('.step'));
      const stepper = Array.from(document.getElementById('stepper').children || []);
      const reviewList = document.getElementById('reviewList');
      const successEl = document.getElementById('bookingSuccess');
      const layoutEl = document.getElementById('bookingLayout');

      const summaryBaseEl = document.getElementById('summary-base-price');
      const summaryDetailEl = document.getElementById('summary-detail-price');
      const summaryDetailRow = document.getElementById('summary-detail-row');
      const summaryExtrasEl = document.getElementById('summary-extras-price');
      const summaryExtrasRow = document.getElementById('summary-extras-row');
      const summaryDiscountEl = document.getElementById('summary-discount-price');
      const summaryDiscountRow = document.getElementById('summary-discount-row');
      const summaryDepositEl = document.getElementById('summary-deposit-price');
      const summaryDepositRow = document.getElementById('summary-deposit-row');
      const summaryBalanceEl = document.getElementById('summary-balance-price');
      const summaryBalanceRow = document.getElementById('summary-balance-row');
      const summaryTotalEl = document.getElementById('summary-total-price');
      const summaryNoteEl = document.getElementById('summary-frequency-note');
      const summaryDetailList = document.getElementById('summary-detail-list');
      const addonEmptyMessage = document.getElementById('addon-empty-message');

      const hiddenServiceKey = document.getElementById('input-service-key');
      const hiddenServiceLabel = document.getElementById('input-service-label');
      const hiddenSqftLabel = document.getElementById('input-sqft-label');
      const hiddenDetailSummary = document.getElementById('input-detail-summary');
      const hiddenBasePrice = document.getElementById('input-base-price');
      const hiddenDetailPrice = document.getElementById('input-detail-price');
      const hiddenAddonsPrice = document.getElementById('input-addons-price');
      const hiddenDiscountPrice = document.getElementById('input-discount-price');
      const hiddenDepositPrice = document.getElementById('input-deposit-price');
      const hiddenBalancePrice = document.getElementById('input-balance-price');
      const hiddenTotalPrice = document.getElementById('input-total-price');
      const hiddenSelectedAddons = document.getElementById('input-selected-addons');
      const hiddenPackage = document.getElementById('input-package');
      const originField = document.getElementById('input-origin');

      const depositText = document.getElementById('deposit-due-text');
      const balanceText = document.getElementById('balance-due-text');

      const frequencyInputs = Array.from(form.querySelectorAll('input[name="frequency"]'));
      const addonGroups = Array.from(form.querySelectorAll('.addon-group'));
      const addonPills = Array.from(form.querySelectorAll('.addon-pill'));

      const DEPOSIT_RATE = 0.5;

      const params = new URLSearchParams(window.location.search);
      const serviceKey = params.get('service') || '';
      const serviceLabel = params.get('serviceLabel') || '';
      const sqftKey = params.get('sqft') || '';
      const sqftLabel = params.get('sqftLabel') || '';
      const basePrice = Number(params.get('basePrice') || params.get('total') || 0);
      const detailPrice = Number(params.get('detailPrice') || 0);
      const totalBase = basePrice + detailPrice;

      const detailSelections = [];
      function pushDetail(label, value){
        if(value){ detailSelections.push(label + ': ' + value); }
      }
      pushDetail('Service', serviceLabel || serviceKey);
      pushDetail('Square Footage', sqftLabel || sqftKey);
      pushDetail('Rooms', params.get('homeRoomsLabel'));
      pushDetail('Bathrooms', params.get('homeBathroomsLabel'));
      pushDetail('Pets', params.get('homePetsLabel'));
      pushDetail('Offices', params.get('officeOfficesLabel'));
      pushDetail('Office Bathrooms', params.get('officeBathroomsLabel'));

      hiddenServiceKey.value = serviceKey;
      hiddenServiceLabel.value = serviceLabel;
      hiddenSqftLabel.value = sqftLabel;
      hiddenDetailSummary.value = detailSelections.join(' | ');
      hiddenBasePrice.value = basePrice.toFixed(2);
      hiddenDetailPrice.value = detailPrice.toFixed(2);
      hiddenPackage.value = serviceLabel || serviceKey;

      if(originField){
        originField.value = serviceKey ? 'instant-quote' : 'book-page';
      }

      const sqftInput = form.querySelector('input[name="sqft"]');
      if(sqftInput && sqftKey){
        const avg = (() => {
          if(sqftKey.includes('-')){
            const parts = sqftKey.split('-').map(p => parseInt(p, 10));
            if(parts.length === 2 && parts.every(n => !Number.isNaN(n))){
              return Math.round((parts[0] + parts[1]) / 2);
            }
          }
          return '';
        })();
        if(avg) sqftInput.value = avg;
      }

      const nameField = form.querySelector('input[name="name"]');
      const emailField = form.querySelector('input[name="email"]');
      const quoteName = params.get('firstName');
      const quoteEmail = params.get('email');
      if(nameField && quoteName) nameField.value = quoteName.trim();
      if(emailField && quoteEmail) emailField.value = quoteEmail.trim();

      function formatCurrency(value){
        if(!value) return '—';
        return `$${Math.round(value).toString()}`;
      }

      function updateDetailList(){
        summaryDetailList.innerHTML = '';
        if(!detailSelections.length){
          const li = document.createElement('li');
          li.className = 'summary-placeholder';
          li.textContent = 'Your base package selections will appear here once you start an instant quote.';
          summaryDetailList.appendChild(li);
          return;
        }
        detailSelections.forEach(item => {
          const [label, val] = item.split(':');
          const li = document.createElement('li');
          li.innerHTML = `<strong>${label.trim()}:</strong> ${val ? val.trim() : ''}`;
          summaryDetailList.appendChild(li);
        });
      }
      updateDetailList();

      function updateAddonVisibility(){
        let visibleGroups = 0;
        addonGroups.forEach(group => {
          const services = (group.dataset.serviceGroup || '').split(',');
          const active = serviceKey && services.includes(serviceKey);
          group.classList.toggle('active', active);
          if(active) visibleGroups += 1;
        });
        if(addonEmptyMessage){ addonEmptyMessage.hidden = visibleGroups !== 0; }
      }
      updateAddonVisibility();

      const extrasState = [];
      function computeExtras(){
        extrasState.length = 0;
        addonPills.forEach(pill => {
          const parent = pill.closest('.addon-group');
          if(!parent || !parent.classList.contains('active')) return;
          if(!pill.classList.contains('active')) return;
          const qtyInput = pill.querySelector('.addon-qty');
          const qty = qtyInput ? Math.max(Number(qtyInput.value) || 1, Number(qtyInput.min) || 1) : 1;
          const price = Number(pill.dataset.price || 0);
          const name = pill.querySelector('.addon-name')?.textContent.trim() || pill.dataset.addon || 'Addon';
          extrasState.push({ name, qty, price });
        });
        return extrasState;
      }

      function buildExtrasLabel(){
        if(!extrasState.length) return '';
        return extrasState.map(item => `${item.name} ×${item.qty}`).join(', ');
      }

      function selectedFrequency(){
        return frequencyInputs.find(input => input.checked) || null;
      }

      function updateSummary(){
        const extras = computeExtras();
        const extrasTotal = extras.reduce((sum, item) => sum + item.price * item.qty, 0);
        const freqInput = selectedFrequency();
        const discountRate = freqInput ? Number(freqInput.dataset.discount || 0) : 0;
        const subtotal = totalBase + extrasTotal;
        const discount = subtotal * discountRate;
        const finalTotal = subtotal - discount;
        const depositDue = finalTotal > 0 ? finalTotal * DEPOSIT_RATE : 0;
        const balanceDue = finalTotal > 0 ? Math.max(finalTotal - depositDue, 0) : 0;

        summaryBaseEl.textContent = formatCurrency(basePrice);

        if(detailPrice > 0){
          summaryDetailRow.hidden = false;
          summaryDetailEl.textContent = `+$${Math.round(detailPrice)}`;
        } else {
          summaryDetailRow.hidden = true;
          summaryDetailEl.textContent = '—';
        }

        if(extrasTotal > 0){
          summaryExtrasRow.hidden = false;
          summaryExtrasEl.textContent = `+$${Math.round(extrasTotal)}`;
        } else {
          summaryExtrasRow.hidden = true;
          summaryExtrasEl.textContent = '—';
        }

        if(discount > 0){
          summaryDiscountRow.hidden = false;
          summaryDiscountEl.textContent = `−$${Math.round(discount)}`;
        } else {
          summaryDiscountRow.hidden = true;
          summaryDiscountEl.textContent = '—';
        }

        if(summaryDepositRow && summaryDepositEl){
          if(depositDue > 0){
            summaryDepositRow.hidden = false;
            summaryDepositEl.textContent = `$${Math.round(depositDue)}`;
          } else {
            summaryDepositRow.hidden = true;
            summaryDepositEl.textContent = '—';
          }
        }

        if(summaryBalanceRow && summaryBalanceEl){
          if(balanceDue > 0){
            summaryBalanceRow.hidden = false;
            summaryBalanceEl.textContent = `$${Math.round(balanceDue)}`;
          } else {
            summaryBalanceRow.hidden = true;
            summaryBalanceEl.textContent = '—';
          }
        }

        if(depositText){ depositText.textContent = depositDue > 0 ? `$${Math.round(depositDue)}` : '—'; }
        if(balanceText){ balanceText.textContent = balanceDue > 0 ? `$${Math.round(balanceDue)}` : '—'; }

        summaryTotalEl.textContent = finalTotal ? formatCurrency(finalTotal) : '—';

        if(summaryNoteEl){
          if(totalBase <= 0){
            summaryNoteEl.textContent = 'Start with an instant quote to unlock pricing.';
          } else if(freqInput){
            const freqLabelMap = {
              weekly: 'Weekly (25% off)',
              biweekly: 'Bi-Weekly (20% off)',
              triweekly: 'Tri-Weekly (15% off)',
              monthly: 'Monthly (10% off)',
              biannual: 'Biannual (5% off)',
              onetime: 'One-time'
            };
            summaryNoteEl.textContent = `Includes ${freqLabelMap[freqInput.value] || 'your chosen frequency'} pricing.`;
          } else {
            summaryNoteEl.textContent = 'Choose a frequency to see recurring savings.';
          }
        }

        if(hiddenAddonsPrice) hiddenAddonsPrice.value = extrasTotal.toFixed(2);
        if(hiddenDiscountPrice) hiddenDiscountPrice.value = discount.toFixed(2);
        if(hiddenDepositPrice) hiddenDepositPrice.value = depositDue.toFixed(2);
        if(hiddenBalancePrice) hiddenBalancePrice.value = balanceDue.toFixed(2);
        if(hiddenTotalPrice) hiddenTotalPrice.value = finalTotal.toFixed(2);
        if(hiddenSelectedAddons) hiddenSelectedAddons.value = buildExtrasLabel();
      }

      addonPills.forEach(pill => {
        const qtyInput = pill.querySelector('.addon-qty');
        if(qtyInput){
          qtyInput.disabled = true;
        }

        pill.addEventListener('click', (event) => {
          if(event.target === qtyInput) return;
          const parent = pill.closest('.addon-group');
          if(!parent || !parent.classList.contains('active')) return;

          pill.classList.toggle('active');
          const active = pill.classList.contains('active');
          pill.setAttribute('aria-pressed', active ? 'true' : 'false');
          if(qtyInput){
            qtyInput.disabled = !active;
            if(active && (!qtyInput.value || Number(qtyInput.value) < Number(qtyInput.min || 1))){
              qtyInput.value = qtyInput.min || 1;
            }
          }
          updateSummary();
        });

        pill.addEventListener('keydown', evt => {
          if(evt.key === 'Enter' || evt.key === ' '){
            evt.preventDefault();
            pill.click();
          }
        });

        pill.setAttribute('tabindex', '0');
        pill.setAttribute('role', 'button');
        pill.setAttribute('aria-pressed', 'false');

        if(qtyInput){
          qtyInput.addEventListener('input', () => {
            if(!pill.classList.contains('active')) return;
            if(qtyInput.value === '' || Number(qtyInput.value) < Number(qtyInput.min || 1)){
              qtyInput.value = qtyInput.min || 1;
            }
            updateSummary();
          });
        }
      });

      frequencyInputs.forEach(input => {
        input.addEventListener('change', updateSummary);
      });

      let current = 0;
      function showStep(i){
        steps.forEach((step, idx) => { step.hidden = idx !== i; });
        stepper.forEach((item, idx) => {
          item.classList.toggle('active', idx === i);
          item.classList.toggle('done', idx < i);
        });
        current = i;
        window.scrollTo({ top: 0, behavior: 'smooth' });
        if(i === steps.length - 1){
          buildReview();
        }
      }

      document.addEventListener('click', (event) => {
        if(event.target.matches('.next')){
          const visible = steps[current];
          const required = Array.from(visible.querySelectorAll('[required]'));
          for(const field of required){
            if(!field.value){
              field.focus();
              if(field.reportValidity){ field.reportValidity(); }
              return;
            }
          }
          showStep(Math.min(current + 1, steps.length - 1));
        }
        if(event.target.matches('.back')){
          showStep(Math.max(current - 1, 0));
        }
      });

      function buildReview(){
        if(!reviewList) return;
        const fd = new FormData(form);
        const freqMap = {
          weekly: 'Weekly (25% off)',
          biweekly: 'Bi-Weekly (20% off)',
          triweekly: 'Tri-Weekly (15% off)',
          monthly: 'Monthly (10% off)',
          biannual: 'Biannual (5% off)',
          onetime: 'One-time'
        };
        const paymentMap = {
          'paypal': 'PayPal',
          'google-pay': 'Google Pay',
          'debit': 'Direct Debit / Card on File'
        };

        const rows = [
          ['Service', hiddenServiceLabel.value || '—'],
          ['Square Footage', hiddenSqftLabel.value || fd.get('sqft') || '—'],
          ['Details', hiddenDetailSummary.value || '—'],
          ['Frequency', freqMap[fd.get('frequency')] || '—'],
          ['Add-ons', hiddenSelectedAddons.value || 'None'],
          ['Base Package', hiddenBasePrice.value ? `$${Math.round(Number(hiddenBasePrice.value))}` : '—'],
          ['Service Details', hiddenDetailPrice.value ? `$${Math.round(Number(hiddenDetailPrice.value))}` : '—'],
          ['Add-on Total', hiddenAddonsPrice.value ? `$${Math.round(Number(hiddenAddonsPrice.value))}` : '—'],
          ['Frequency Savings', hiddenDiscountPrice.value && Number(hiddenDiscountPrice.value) ? `-$${Math.round(Number(hiddenDiscountPrice.value))}` : '—'],
          ['Deposit Due Today', hiddenDepositPrice.value && Number(hiddenDepositPrice.value) ? `$${Math.round(Number(hiddenDepositPrice.value))}` : '—'],
          ['Balance at Service', hiddenBalancePrice.value && Number(hiddenBalancePrice.value) ? `$${Math.round(Number(hiddenBalancePrice.value))}` : '—'],
          ['Estimated Visit Total', hiddenTotalPrice.value && Number(hiddenTotalPrice.value) ? `$${Math.round(Number(hiddenTotalPrice.value))}` : '—'],
          ['Payment Method', paymentMap[fd.get('payment_method')] || '—'],
          ['Business', fd.get('business') || '—'],
          ['Address', [fd.get('address'), fd.get('city'), fd.get('postal')].filter(Boolean).join(', ') || '—'],
          ['Preferred Date', fd.get('date') || '—'],
          ['Preferred Time', fd.get('time') || '—'],
          ['Full Name', fd.get('name') || '—'],
          ['Email', fd.get('email') || '—'],
          ['Phone', fd.get('phone') || '—'],
          ['Notes', fd.get('notes') || '—']
        ];

        reviewList.innerHTML = rows.map(([label, value]) => `<dt>${label}</dt><dd>${String(value)}</dd>`).join('');
      }

      form.addEventListener('submit', async (event) => {
        event.preventDefault();

        const submitBtn = form.querySelector('.submit');
        const allButtons = form.querySelectorAll('button');
        allButtons.forEach(btn => btn.disabled = true);
        if(submitBtn) submitBtn.textContent = 'Sending…';

        const fd = new FormData(form);
        if(!fd.get('_subject')){
          fd.append('_subject', 'New Booking Request — Dufferin Deep Clean');
        }

        const freqMapShort = {
          weekly: 'Weekly (25%)',
          biweekly: 'Bi-Weekly (20%)',
          triweekly: 'Tri-Weekly (15%)',
          monthly: 'Monthly (10%)',
          biannual: 'Biannual (5%)',
          onetime: 'One-time'
        };
        const paymentMapShort = {
          'paypal': 'PayPal',
          'google-pay': 'Google Pay',
          'debit': 'Direct Debit / Card on File'
        };

        const pricingSummary = [
          `Service: ${hiddenServiceLabel.value || serviceKey || '—'}`,
          `Square Footage: ${hiddenSqftLabel.value || fd.get('sqft') || '—'}`,
          `Details: ${hiddenDetailSummary.value || '—'}`,
          `Frequency: ${freqMapShort[fd.get('frequency')] || '—'}`,
          `Base Package: ${hiddenBasePrice.value ? `$${Math.round(Number(hiddenBasePrice.value))}` : '—'}`,
          `Service Details: ${hiddenDetailPrice.value ? `$${Math.round(Number(hiddenDetailPrice.value))}` : '—'}`,
          `Add-ons: ${hiddenSelectedAddons.value || 'None'}`,
          `Add-on Total: ${hiddenAddonsPrice.value ? `$${Math.round(Number(hiddenAddonsPrice.value))}` : '—'}`,
          `Frequency Savings: ${hiddenDiscountPrice.value && Number(hiddenDiscountPrice.value) ? `-$${Math.round(Number(hiddenDiscountPrice.value))}` : '—'}`,
          `Deposit Due Today: ${hiddenDepositPrice.value && Number(hiddenDepositPrice.value) ? `$${Math.round(Number(hiddenDepositPrice.value))}` : '—'}`,
          `Balance at Service: ${hiddenBalancePrice.value && Number(hiddenBalancePrice.value) ? `$${Math.round(Number(hiddenBalancePrice.value))}` : '—'}`,
          `Estimated Visit Total: ${hiddenTotalPrice.value && Number(hiddenTotalPrice.value) ? `$${Math.round(Number(hiddenTotalPrice.value))}` : '—'}`,
          `Payment Method: ${paymentMapShort[fd.get('payment_method')] || fd.get('payment_method') || '—'}`
        ].join('\n');

        fd.append('pricing_summary', pricingSummary);

        try {
          const res = await fetch(form.action, {
            method: 'POST',
            body: fd,
            headers: { Accept: 'application/json' }
          });

          if(res.ok){
            form.hidden = true;
            if(layoutEl) layoutEl.hidden = true;
            if(successEl) successEl.hidden = false;
          } else {
            let message = 'There was a problem sending your booking request. Please try again.';
            try {
              const data = await res.json();
              if(data && data.errors && data.errors.length){
                message = data.errors.map(err => err.message).join('\n');
              }
            } catch(_){}
            alert(message);
          }
        } catch(err){
          alert('Network error. Please check your connection and try again.');
        } finally {
          allButtons.forEach(btn => btn.disabled = false);
          if(submitBtn) submitBtn.textContent = 'Submit';
        }
      });

      updateSummary();
      showStep(0);
    })();
  </script>
</body>
</html>
